import{r,u as O,j as e,I as k,B as V,d as B,_ as L}from"./index-oPn2WTdF.js";import{u as H,T as G,a as U,b as K,c as z,f as P,d as A,e as W,h as $,i as J}from"./index-dk_EvJ6X.js";import{D as q,a as Q,b as X,c as Y,d as Z,e as ee,E as ae}from"./exceljs.min-CzmseXLb.js";import{S as F,a as T,b as M,c as I,d as s}from"./select-DuplxWhz.js";const te=({children:y,id:R,type_case:p,defendantName:v,imprisonmentDuration:S,startDate:u,member_Location:_,case_Number:g})=>{const[w,f]=r.useState(g),[b,j]=r.useState(v),[h,E]=r.useState(u?new Date(u):null),[D,C]=r.useState(S?parseInt(S.toString()):void 0),[N,a]=r.useState(_),[t,o]=r.useState(p),{userData:x}=O(),c=x==null?void 0:x.member_id,m=async i=>{i.preventDefault();const l={id:R};if(w&&(l.caseNumber=w),b&&(l.defendantName=b),h&&(l.startDate=h),D&&(l.imprisonmentDuration=D),N&&(l.member_location=N),t&&(l.type_case=t),c&&(l.member_number=c.toString()),Object.keys(l).length>1)try{const d=await B.put("http://localhost:3000/api/public/cases/edit",l);console.log(d),L.success("تم التحديث بنجاح!")}catch(d){L.error("فشلت عملية التحديث"),console.error("Error updating case:",d)}else L.error("يرجى ملء حقل واحد على الأقل للتحديث")},n=i=>{const{name:l,value:d}=i.target;switch(l){case"caseNumber":f(d);break;case"accusedName":j(d);break;case"caseDate":E(new Date(d));break;case"casePrisonDate":C(parseInt(d));break;case"memberLocation":a(d);break}};return e.jsxs(q,{children:[e.jsx(Q,{asChild:!0,children:y}),e.jsxs(X,{dir:"rtl",className:"bg-[#1B2431] text-white border-none",children:[e.jsx(Y,{children:e.jsx(Z,{children:"تعديل القضية"})}),e.jsxs("form",{onSubmit:m,className:"space-y-4 flex flex-col justify-center",children:[e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"caseNumber",children:"رقم القضية"}),e.jsx(k,{value:w,name:"caseNumber",onChange:n,type:"text",min:"1",placeholder:"رقم القضية",className:"bg-[#273142] text-white w-full"})]}),e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"accusedName",children:"اسم المتهم"}),e.jsx(k,{value:b,name:"accusedName",onChange:n,type:"text",placeholder:"اسم المتهم",className:"bg-[#273142] text-white w-full"})]}),e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"caseDate",children:"مدة البداية"}),e.jsx(k,{value:h?h.toISOString().split("T")[0]:"",name:"caseDate",onChange:n,type:"date",placeholder:"بداية الحبس",className:"bg-[#273142] text-white w-full"})]}),e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"casePrisonDate",children:"مدة الحبس"}),e.jsx(k,{value:D,name:"casePrisonDate",onChange:n,type:"number",min:"1",placeholder:"مدة الحبس",className:"bg-[#273142] text-white w-full"})]}),e.jsxs("div",{dir:"rtl",className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{className:" text-white text-sm",htmlFor:"caseRenewalDate",children:"مكان العضو"}),e.jsxs(F,{disabled:!0,value:c?c.toString():"",children:[e.jsx(T,{className:"bg-[#273142] text-white w-full",children:e.jsx(M,{placeholder:"رقم العضو"})}),e.jsxs(I,{children:[e.jsx(s,{value:"1",children:"1"}),e.jsx(s,{value:"2",children:"2"}),e.jsx(s,{value:"3",children:"3"}),e.jsx(s,{value:"4",children:"4"}),e.jsx(s,{value:"5",children:"5"}),e.jsx(s,{value:"6",children:"6"}),e.jsx(s,{value:"7",children:"7"}),e.jsx(s,{value:"8",children:"8"}),e.jsx(s,{value:"9",children:"9"}),e.jsx(s,{value:"10",children:"10"})]})]})]}),e.jsxs("div",{dir:"rtl",className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{className:" text-white text-sm",htmlFor:"caseRenewalDate",children:"مكان التجديد"}),e.jsxs(F,{value:N,onValueChange:i=>a(i),children:[e.jsx(T,{className:"bg-[#273142] text-white w-full",children:e.jsx(M,{placeholder:"مكان التجديد"})}),e.jsxs(I,{children:[e.jsx(s,{value:"جزئي",children:"جزئي"}),e.jsx(s,{value:"مستأنف",children:"مستأنف"}),e.jsx(s,{value:"جنايات",children:"جنايات"}),e.jsx(s,{value:"رئيس نيابة",children:"رئيس نيابة"})]})]})]}),e.jsxs("div",{dir:"rtl",className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{className:" text-white text-sm",htmlFor:"caseRenewalDate",children:"نوع القضية"}),e.jsxs(F,{dir:"rtl",value:t,onValueChange:i=>o(i),children:[e.jsx(T,{className:"bg-[#273142] text-white w-full",children:e.jsx(M,{placeholder:"نوع القضية"})}),e.jsxs(I,{children:[e.jsx(s,{value:"جنحة ",children:"جنحة "}),e.jsx(s,{value:"جناية  ",children:"جناية  "}),e.jsx(s,{value:"اداري ",children:"اداري "})]})]})]}),e.jsx(V,{type:"submit",variant:"default",className:"bg-[#4741DE] hover:bg-[#6A68FF] self-center min-w-56",children:"حفظ التعديلات"})]}),e.jsx(ee,{className:"mt-4"})]})]})},ne=()=>{const[y,R]=r.useState([]),[p,v]=r.useState([]),[S]=r.useState(10),[u,_]=r.useState(""),[g,w]=r.useState(""),[f,b]=r.useState(!0),[j,h]=r.useState(""),E=async()=>{try{b(!0);const t=(await B.get("http://localhost:3000/api/public/cases")).data.cases||[];R(t),v(t),h("")}catch{h("فشل في جلب البيانات")}finally{b(!1)}};r.useEffect(()=>{E()},[]),r.useEffect(()=>{(()=>{const t=y.filter(o=>{const x=o.caseNumber.toLowerCase().includes(u.toLowerCase());let c=!0;if(g)try{const m=new Date(o.startDate),n=new Date(m);n.setDate(m.getDate()+(o.imprisonmentDuration||0)-1),c=n.toISOString().split("T")[0]===new Date(g).toISOString().split("T")[0]}catch{c=!1}return x&&c});v(t)})()},[u,g,y]);const D=r.useMemo(()=>[{accessorKey:"id",header:"رقم مسلسل"},{accessorKey:"defendantName",header:"اسم المتهم"},{accessorKey:"imprisonmentDuration",header:"مدة الحبس"},{accessorKey:"startDate",header:"بداية المدة",cell:a=>new Date(a.getValue()).toLocaleDateString("ar-EG")},{header:"موعد التجديد",cell:a=>{try{const t=new Date(a.row.original.startDate),o=new Date(t);return o.setDate(t.getDate()+(a.row.original.imprisonmentDuration||0)-1),o.toLocaleDateString("ar-EG")}catch{return"تاريخ غير صحيح"}}},{accessorKey:"member_location",header:"مكان التجديد"},{accessorKey:"member_number",header:"رقم العضو"},{accessorKey:"type_case",header:"نوع القضية"},{accessorKey:"caseNumber",header:"رقم القضية"},{header:"تعديل",cell:a=>e.jsx("div",{className:"flex justify-center items-center w-[50px]",children:e.jsx(te,{id:Number(a.row.original.id),case_Number:a.row.original.caseNumber,defendantName:a.row.original.defendantName,imprisonmentDuration:a.row.original.imprisonmentDuration,startDate:new Date(a.row.original.startDate),member_Location:a.row.original.member_location,memberNumber:a.row.original.member_number,type_case:a.row.original.type_case,children:e.jsx("img",{src:"/edit.svg",width:24,height:24,alt:"تعديل"})})})}],[]),C=H({data:p,columns:D,state:{pagination:{pageIndex:0,pageSize:S}},getCoreRowModel:J(),getPaginationRowModel:$()}),N=async()=>{try{const a=new ae.Workbook,t=a.addWorksheet("Cases");t.columns=[{header:"رقم مسلسل",key:"id",width:15},{header:"اسم المتهم",key:"defendantName",width:20},{header:"مدة الحبس",key:"imprisonmentDuration",width:15},{header:"بداية المدة",key:"startDate",width:20},{header:"موعد التجديد",key:"renewalDate",width:20},{header:"مكان التجديد",key:"member_location",width:20},{header:"رقم العضو",key:"member_number",width:15},{header:"نوع القضية",key:"type_case",width:20},{header:"رقم القضية",key:"caseNumber",width:20}],p.forEach(n=>{const i=new Date(n.startDate),l=new Date(i);l.setDate(i.getDate()+(n.imprisonmentDuration||0)-1),t.addRow({...n,startDate:i.toLocaleDateString("ar-EG"),renewalDate:l.toLocaleDateString("ar-EG")})});const o=await a.xlsx.writeBuffer(),x=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=URL.createObjectURL(x),m=document.createElement("a");m.href=c,m.download="Cases.xlsx",m.click(),URL.revokeObjectURL(c)}catch{alert("فشل التصدير")}};return e.jsx("div",{className:"flex flex-col items-center min-h-screen p-4 bg-gray-50",children:e.jsxs("div",{className:"w-full max-w-6xl space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex gap-4 flex-1",children:[e.jsx("input",{type:"text",placeholder:"رقم القضية",value:u,onChange:a=>_(a.target.value),className:"border rounded-lg p-2 w-full max-w-xs focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"date",value:g,onChange:a=>w(a.target.value),className:"border rounded-lg p-2 w-full max-w-xs focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("button",{onClick:N,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx("span",{children:"تصدير إلى أكسل"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})})]})]}),f&&e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"animate-spin inline-block w-8 h-8 border-4 border-blue-500 rounded-full border-t-transparent"}),e.jsx("p",{className:"mt-2 text-blue-600",children:"جاري التحميل..."})]}),j&&e.jsx("div",{className:"bg-red-100 p-4 rounded-lg text-red-700 text-center",children:j}),!f&&!j&&e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs(G,{className:"w-full",children:[e.jsx(U,{className:"bg-gray-50",children:C.getHeaderGroups().map(a=>e.jsx(K,{children:a.headers.map(t=>e.jsx(z,{className:"px-4 py-3 text-right font-semibold text-gray-700 border-b",children:P(t.column.columnDef.header,t.getContext())},t.id))},a.id))}),e.jsx(A,{children:C.getRowModel().rows.map(a=>e.jsx(K,{className:"hover:bg-gray-50 transition-colors even:bg-gray-50",children:a.getVisibleCells().map(t=>e.jsx(W,{className:"px-4 py-3 text-right border-b",children:P(t.column.columnDef.cell,t.getContext())},t.id))},a.id))})]}),p.length===0&&!f&&e.jsx("div",{className:"p-6 text-center text-gray-500",children:"لا توجد بيانات متطابقة مع عوامل التصفية"})]})]})})};export{ne as default};
