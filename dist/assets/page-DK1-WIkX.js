import{r as l,u as ce,j as e,I as S,B as w,d as V,_ as G}from"./index-DuPbkBlM.js";import{u as je,T as ge,a as pe,b as te,c as fe,f as le,d as be,e as ye,g as ve,h as Ne}from"./index-D_kfmhOx.js";import{D as re,a as ie,b as ne,c as Se,d as we,E as Ce}from"./exceljs.min-Cgt3dj46.js";import{S as x,a as h,b as m,c as u,d as c}from"./select-C4qD4X4P.js";import{A as Z,m as H}from"./proxy-CJ9Tpz7V.js";import{X as ke,P as Re}from"./progress-B5vEx7DL.js";const De=({children:C,caseID:I,caseNumber:a,accusation:j,defendantQuestion:k,officerQuestion:O,victimQuestion:f,witnessQuestion:F,technicalReports:M,caseReferral:A,isReadyForDecision:W,actionOther:R})=>{const[D,L]=l.useState(a),{userData:E}=ce(),[P,g]=l.useState(j),[b,$]=l.useState(k),[K,U]=l.useState(O),[Q,s]=l.useState(f),[t,i]=l.useState(F),[p,z]=l.useState(M),[T,B]=l.useState(A),[n,y]=l.useState(0),[v,N]=l.useState(""),[_,oe]=l.useState(""),[J,de]=l.useState(""),[xe,Pe]=l.useState(W),[X,he]=l.useState(""),[q,me]=l.useState(R),[ee,se]=l.useState(!1),Y=E==null?void 0:E.member_id,ue=async o=>{o.preventDefault();const r={id:I.toString()};if(D&&(r.caseNumber=D),Y&&(r.memberNumber=Y.toString()),P&&(r.accusation=P),n&&(r.year=n),v&&(r.caseType=v),_&&(r.investigationID=_),J&&(r.accusedName=J),b&&(r.defendantQuestion=b),K&&(r.officerQuestion=K),Q&&(r.victimQuestion=Q),t&&(r.witnessQuestion=t),p&&(r.technicalReports=p),X&&(r.reportType=X),T&&(r.caseReferral=T),q&&(r.actionOther=q),r.isReadyForDecision=xe,Object.keys(r).length>1)try{const ae=await V.put("http://localhost:3000/api/private/cases/edit",r);G.success("تم التحديث بنجاح!")}catch(ae){G.error("فشلت عملية التحديث"),console.error(ae)}else G.error("يرجى ملء حقل واحد على الأقل للتحديث")};return e.jsx(Z,{children:e.jsxs(re,{open:ee,onOpenChange:se,children:[e.jsx(ie,{asChild:!0,children:C}),e.jsx(Z,{children:ee&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(H.div,{initial:{scale:.8},animate:{scale:1},className:"bg-white rounded-2xl shadow-xl p-8 border border-blue-100 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ne,{children:e.jsx("h2",{className:"text-2xl font-bold mb-6 text-center text-blue-600",children:"تعديل بيانات القضية"})}),e.jsxs("form",{onSubmit:ue,className:"space-y-8",children:[e.jsxs("fieldset",{className:"border-2 border-blue-100 rounded-xl p-6",children:[e.jsx("legend",{className:"px-2 text-xl font-semibold text-blue-600",children:"بيانات القضية"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"رقم القضية"}),e.jsx(S,{type:"text",value:D,onChange:o=>L(o.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"السنة"}),e.jsx(S,{type:"number",value:n,onChange:o=>y(Number(o.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"نوع القضية"}),e.jsxs(x,{value:v,onValueChange:N,children:[e.jsx(h,{children:e.jsx(m,{placeholder:"اختر النوع"})}),e.jsxs(u,{children:[e.jsx(c,{value:"جنحة",children:"جنحة"}),e.jsx(c,{value:"جناية",children:"جناية"}),e.jsx(c,{value:"إداري",children:"إداري"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"رقم حصر التحقيق"}),e.jsx(S,{type:"text",value:_,onChange:o=>oe(o.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:" التهمة "}),e.jsx(S,{type:"text",value:P,onChange:o=>g(o.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"اسم المتهم"}),e.jsx(S,{type:"text",value:J,onChange:o=>de(o.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"رقم العضو"}),e.jsx(S,{type:"text",value:Y||"",disabled:!0})]})]})]}),e.jsxs("fieldset",{className:"border-2 border-blue-100 rounded-xl p-6",children:[e.jsx("legend",{className:"px-2 text-xl font-semibold text-blue-600",children:"الإجراءات"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"سؤال المتهم"}),e.jsxs(x,{value:b,onValueChange:$,children:[e.jsx(h,{children:e.jsx(m,{placeholder:"اختر الحالة"})}),e.jsxs(u,{children:[e.jsx(c,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(c,{value:"تم",children:"تم"}),e.jsx(c,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"سؤال المجني عليه"}),e.jsxs(x,{value:Q,onValueChange:s,children:[e.jsx(h,{children:e.jsx(m,{placeholder:"اختر الحالة"})}),e.jsxs(u,{children:[e.jsx(c,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(c,{value:"تم",children:"تم"}),e.jsx(c,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"سؤال الشهود"}),e.jsxs(x,{value:t,onValueChange:i,children:[e.jsx(h,{children:e.jsx(m,{placeholder:"اختر الحالة"})}),e.jsxs(u,{children:[e.jsx(c,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(c,{value:"تم",children:"تم"}),e.jsx(c,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"سؤال الظابط "}),e.jsxs(x,{value:K,onValueChange:U,children:[e.jsx(h,{children:e.jsx(m,{placeholder:"اختر الحالة"})}),e.jsxs(u,{children:[e.jsx(c,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(c,{value:"تم",children:"تم"}),e.jsx(c,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"تقارير فنية"}),e.jsxs(x,{value:p,onValueChange:z,children:[e.jsx(h,{children:e.jsx(m,{placeholder:"اختر الحالة"})}),e.jsxs(u,{children:[e.jsx(c,{value:"تم",children:"تم"}),e.jsx(c,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(c,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),p==="حتى الآن"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"نوع التقرير"}),e.jsx(S,{type:"text",value:X,onChange:o=>he(o.target.value),required:M==="حتى الآن"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"اجراءات اخرى"}),e.jsxs(x,{value:R,onValueChange:me,children:[e.jsx(h,{children:e.jsx(m,{placeholder:"اختر الحالة"})}),e.jsxs(u,{children:[e.jsx(c,{value:"تم",children:"تم"}),e.jsx(c,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(c,{value:"حتى الآن",children:"حتى الآن"})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(w,{type:"button",onClick:()=>se(!1),variant:"outline",className:"px-6 py-2 border-gray-300",children:"إلغاء"}),e.jsx(w,{type:"submit",className:"bg-indigo-600 hover:bg-indigo-700 px-6 py-2",children:"حفظ التغييرات"})]})]})]})})})]})})},d=({children:C,contact:I})=>e.jsxs(re,{children:[e.jsx(ie,{asChild:!0,dir:"rtl",children:C}),e.jsxs(Se,{className:"text-center",children:[e.jsx(ne,{children:e.jsx(we,{children:"المحتوى"})}),e.jsx("div",{children:I})]})]}),_e=()=>{const[C,I]=l.useState([]),[a,j]=l.useState({page:1,pageSize:10,total:0,totalPages:1}),[k,O]=l.useState(""),[f,F]=l.useState(""),[M,A]=l.useState(!1),[W,R]=l.useState(!1),[D,L]=l.useState(0),[E,P]=l.useState(!1),{userData:g}=ce(),b=g==null?void 0:g.role;g==null||g.id;const $=l.useMemo(()=>[{accessorKey:"caseNumber",header:"رقم القضية",cell:({getValue:s})=>e.jsx(d,{contact:s(),children:e.jsx("p",{children:s()})})},{accessorKey:"year",header:"السنة",cell:({getValue:s})=>e.jsx(d,{contact:s(),children:e.jsx("p",{children:s()})})},{accessorKey:"caseType",header:"نوع القضية",cell:({getValue:s})=>e.jsx(d,{contact:s(),children:e.jsx("p",{children:s()})})},{accessorKey:"investigationID",header:"رقم حصر التحقيق",cell:({getValue:s})=>e.jsx(d,{contact:s(),children:e.jsx("p",{children:s()})})},{accessorKey:"accusedName",header:"اسم المتهم",cell:({getValue:s})=>e.jsx(d,{contact:s(),children:e.jsx("p",{children:s()})})},{accessorKey:"accusation",header:"التهمة",cell:({getValue:s})=>e.jsx(d,{contact:s(),children:e.jsx("p",{children:s()})})},{accessorKey:"memberNumber",header:"رقم العضو",cell:({getValue:s})=>e.jsx(d,{contact:s(),children:e.jsx("p",{children:s()})})},{accessorKey:"defendantQuestion",header:"سؤال المتهم",cell:({getValue:s})=>e.jsx(d,{contact:s(),children:e.jsx("p",{children:s()})})},{accessorKey:"victimQuestion",header:"سؤال المجني عليه",cell:({getValue:s})=>e.jsx(d,{contact:s(),children:e.jsx("p",{children:s()})})},{accessorKey:"witnessQuestion",header:"سؤال الشهود",cell:({getValue:s})=>e.jsx(d,{contact:s(),children:e.jsx("p",{children:s()})})},{accessorKey:"officerQuestion",header:"سؤال الضابط",cell:({getValue:s})=>e.jsx(d,{contact:s(),children:e.jsx("p",{children:s()})})},{accessorKey:"technicalReports",header:"التقارير الفنية",cell:({getValue:s})=>e.jsx(d,{contact:s(),children:e.jsx("p",{children:s()})})},{accessorKey:"reportType",header:"نوع التقرير",cell:({getValue:s})=>e.jsx(d,{contact:s(),children:e.jsx("p",{children:s()})})},{accessorKey:"actionOther",header:"إجراءات أخرى"},{accessorKey:"isReadyForDecision",header:"جاهزة للتصرف",cell:({row:s})=>[s.original.defendantQuestion,s.original.officerQuestion,s.original.victimQuestion,s.original.witnessQuestion,s.original.technicalReports].some(i=>i==null?void 0:i.includes("حتى الآن"))?"لا":"نعم"},{header:"تعديل",cell:({row:s})=>e.jsx("div",{className:"flex justify-center",children:e.jsx(De,{caseID:Number(s.original.id),...s.original,children:e.jsx("img",{src:"/edit.svg",alt:"edit",className:"w-6 h-6"})})})}],[]),K=async(s,t)=>{try{const i={page:s,pageSize:t,memberNumber:k,isReadyForDecision:f==="نعم"?!0:f==="لا"?!1:void 0},z=(await V.get("http://localhost:3000/api/private/cases",{params:i,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data||{},T=z.data||[],B=z.pagination||{page:1,pageSize:10,total:0,totalPages:1};I(T.map(n=>({...n,isReadyForDecision:!!(n.defendantQuestion&&n.officerQuestion&&n.victimQuestion&&n.witnessQuestion&&n.technicalReports&&n.caseReferral)}))),j(B)}catch(i){console.error("Error fetching data:",i)}};l.useEffect(()=>{b==="admin"||b==="editor"?(A(!0),K(a.page,a.pageSize)):A(!1)},[b,a.page,a.pageSize,k,f]);const U=async()=>{P(!0);try{const s=new Ce.Workbook,t=s.addWorksheet("القضايا");t.columns=$.map(y=>{var v,N;return{header:((v=y.header)==null?void 0:v.toString())||"",key:((N="accessorKey"in y?y.accessorKey:y.accessor)==null?void 0:N.toString())||"",width:25}});let i=1,p=0;for(;i<=((a==null?void 0:a.totalPages)||1);){const N=((await V.get("http://localhost:3000/api/private/cases",{params:{page:i,pageSize:100,memberNumber:k,isReadyForDecision:f==="نعم"}})).data||{}).data||[];N.forEach(_=>{t.addRow(_)}),p+=N.length,L(p/((a==null?void 0:a.total)||1)*100),i++}const z=await s.xlsx.writeBuffer(),T=new Blob([z],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),B=window.URL.createObjectURL(T),n=document.createElement("a");n.href=B,n.download=`القضايا_${new Date().toISOString()}.xlsx`,n.click()}catch(s){console.error("Export error:",s)}finally{P(!1),R(!1)}},Q=je({data:C,columns:$,state:{pagination:{pageIndex:((a==null?void 0:a.page)||1)-1,pageSize:(a==null?void 0:a.pageSize)||10}},pageCount:(a==null?void 0:a.totalPages)||1,manualPagination:!0,onPaginationChange:s=>{const t=typeof s=="function"?s({pageIndex:((a==null?void 0:a.page)||1)-1,pageSize:(a==null?void 0:a.pageSize)||10}):s;typeof t.pageSize=="number"?j(i=>({...i||{page:1,pageSize:10,total:0,totalPages:1},pageSize:t.pageSize,page:1})):j(i=>({...i||{page:1,pageSize:10,total:0,totalPages:1},page:(t.pageIndex||0)+1}))},getCoreRowModel:Ne(),getPaginationRowModel:ve()});return M?e.jsx("div",{dir:"rtl",className:"min-h-screen bg-gradient-to-b from-blue-50 to-indigo-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:" h-[70px] text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"إدارة القضايا"}),e.jsx(w,{onClick:()=>R(!0),className:"bg-green-600 hover:bg-green-700 text-white",children:"تصدير إلى Excel"})]}),e.jsx(Z,{children:W&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(H.div,{initial:{scale:.8},animate:{scale:1},className:"bg-white rounded-2xl shadow-xl p-8 border border-blue-100 w-full max-w-md relative",children:[e.jsx("button",{onClick:()=>R(!1),className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",children:e.jsx(ke,{className:"h-6 w-6"})}),e.jsx("div",{className:"space-y-6 text-center",children:E?e.jsxs(e.Fragment,{children:[e.jsx(Re,{value:D,className:"h-3"}),e.jsxs("p",{className:"text-gray-600",children:["جار التصدير... ",Math.round(D),"%"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"تصدير البيانات"}),e.jsx(w,{onClick:U,className:"bg-indigo-600 hover:bg-indigo-700 w-full",children:"بدء التصدير"})]})})]})})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-blue-100",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs(x,{value:k,onValueChange:O,children:[e.jsx(h,{className:"w-40",children:e.jsx(m,{placeholder:"رقم العضو"})}),e.jsx(u,{children:Array.from({length:10},(s,t)=>e.jsx(c,{value:`${t+1}`,children:t+1},t+1))})]}),e.jsxs(x,{value:f,onValueChange:F,children:[e.jsx(h,{className:"w-40",children:e.jsx(m,{placeholder:"جاهزة للتصرف"})}),e.jsxs(u,{children:[e.jsx(c,{value:"نعم",children:"نعم"}),e.jsx(c,{value:"لا",children:"لا"})]})]}),e.jsx(w,{variant:"outline",onClick:()=>{O(""),F("")},children:"مسح التصنيفات"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-gray-600",children:"العناصر لكل صفحة:"}),e.jsxs(x,{value:`${(a==null?void 0:a.pageSize)||10}`,onValueChange:s=>j(t=>({...t||{page:1,pageSize:10,total:0,totalPages:1},pageSize:Number(s),page:1})),children:[e.jsx(h,{className:"w-20",children:e.jsx(m,{})}),e.jsx(u,{children:[10,20,50,100].map(s=>e.jsx(c,{value:`${s}`,children:s},s))})]})]})]}),e.jsxs(ge,{className:"w-full",children:[e.jsx(pe,{className:"bg-gray-50",children:Q.getHeaderGroups().map(s=>e.jsx(te,{children:s.headers.map(t=>e.jsx(fe,{className:"px-4 py-3 text-right font-semibold text-gray-700 border-b",children:le(t.column.columnDef.header,t.getContext())},t.id))},s.id))}),e.jsx(be,{children:Q.getRowModel().rows.map(s=>e.jsx(te,{className:"hover:bg-gray-50 transition-colors even:bg-gray-50",children:s.getVisibleCells().map(t=>e.jsx(ye,{className:"text-center p-3 border-t border-gray-100",children:le(t.column.columnDef.cell,t.getContext())},t.id))},s.id))})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mt-6 gap-4",children:[e.jsxs("div",{className:"text-gray-500 text-sm",children:["عرض ",C.length," من أصل ",(a==null?void 0:a.total)||0," قضية"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{variant:"outline",onClick:()=>j(s=>({...s||{page:1,pageSize:10,total:0,totalPages:1},page:((s==null?void 0:s.page)||1)-1})),disabled:((a==null?void 0:a.page)||1)===1,children:"السابق"}),e.jsxs("span",{className:"px-4",children:["الصفحة ",(a==null?void 0:a.page)||1," من ",(a==null?void 0:a.totalPages)||1]}),e.jsx(w,{variant:"outline",onClick:()=>j(s=>({...s||{page:1,pageSize:10,total:0,totalPages:1},page:((s==null?void 0:s.page)||1)+1})),disabled:((a==null?void 0:a.page)||1)>=((a==null?void 0:a.totalPages)||1),children:"التالي"})]})]})]})]})}):e.jsx("div",{className:"flex items-center justify-center h-screen bg-gradient-to-b from-blue-50 to-indigo-50",children:e.jsx("p",{className:"text-2xl text-red-500",children:"غير مصرح لك بالوصول إلى هذه الصفحة"})})};export{_e as default};
