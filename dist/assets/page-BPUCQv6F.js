import{r as c,u as G,j as e,I as z,B as U,d as $,_ as H}from"./index-oPn2WTdF.js";import{u as re,T as ce,a as ie,b as W,c as le,f as J,d as ne,e as oe,g as de,h as he,i as ue}from"./index-dk_EvJ6X.js";import{D as X,a as Y,b as Z,c as q,d as ee,e as xe,E as me}from"./exceljs.min-CzmseXLb.js";import{S as h,a as u,b as x,c as m,d as a}from"./select-DuplxWhz.js";const je=({children:g,caseID:p,caseNumber:E,accusation:y,defendantQuestion:O,officerQuestion:w,victimQuestion:S,witnessQuestion:v,technicalReports:D,caseReferral:K,isReadyForDecision:V,actionOther:j})=>{const[b,T]=c.useState(E),{userData:Q}=G(),[R,M]=c.useState(y),[C,n]=c.useState(O),[k,P]=c.useState(w),[F,s]=c.useState(S),[t,o]=c.useState(v),[r,i]=c.useState(D),[N,B]=c.useState(K),[se,be]=c.useState(V),[I,te]=c.useState(j),_=Q==null?void 0:Q.member_id,ae=async A=>{A.preventDefault();const l={id:p.toString()};if(b&&(l.caseNumber=b),_&&(l.memberNumber=_.toString()),R&&(l.accusation=R),C&&(l.defendantQuestion=C),k&&(l.officerQuestion=k),F&&(l.victimQuestion=F),t&&(l.witnessQuestion=t),r&&(l.technicalReports=r),N&&(l.caseReferral=N),I&&(l.actionOther=I),l.isReadyForDecision=se,Object.keys(l).length>1)try{const d=await $.put("http://localhost:3000/api/private/cases/edit",l);H.success("تم التحديث بنجاح!")}catch(d){H.error("فشلت عملية التحديث"),console.error(d)}else H.error("يرجى ملء حقل واحد على الأقل للتحديث")},L=A=>{const{name:l,value:d}=A.target;switch(l){case"caseNumber":T(d);break;case"accusation":M(d);break;case"defendantQuestion":n(d);break;case"officerQuestion":P(d);break;case"victimQuestion":s(d);break;case"witnessQuestion":o(d);break;case"technicalReports":i(d);break;case"caseReferral":B(d);break}};return e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:g}),e.jsxs(Z,{dir:"rtl",className:"bg-[#1B2431]  text-white border-none",children:[e.jsx(q,{children:e.jsx(ee,{children:"تعديل القضية"})}),e.jsxs("form",{onSubmit:ae,className:"space-y-4 flex flex-col justify-center",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"caseNumber",children:"رقم القضية"}),e.jsx(z,{name:"caseNumber",value:b,onChange:L,type:"text",min:"1",placeholder:"رقم القضية",className:"bg-[#283444] text-white w-full"})]}),e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"memberNumber",children:"رقم العضو"}),e.jsxs(h,{dir:"rtl",disabled:!0,value:_?_.toString():"",children:[e.jsx(u,{className:"w-[175px] bg-[#283444]  text-white  border-white  ",children:e.jsx(x,{placeholder:"رقم العضو"})}),e.jsxs(m,{className:"bg-[#1B2431]  text-white border-none",children:[e.jsx(a,{value:"1",children:"1"}),e.jsx(a,{value:"2",children:"2"}),e.jsx(a,{value:"3",children:"3"}),e.jsx(a,{value:"4",children:"4"}),e.jsx(a,{value:"5",children:"5"}),e.jsx(a,{value:"6",children:"6"}),e.jsx(a,{value:"7",children:"7"}),e.jsx(a,{value:"8",children:"8"}),e.jsx(a,{value:"9",children:"9"}),e.jsx(a,{value:"10",children:"10"})]})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"accusation",children:"التهمة"}),e.jsx(z,{name:"accusation",onChange:L,value:R,type:"text",placeholder:"التهمة",className:"bg-[#273142] text-white w-full"})]}),e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"defendantQuestion",children:"سؤال المتهم"}),e.jsxs(h,{dir:"rtl",value:C,name:"defendantQuestion",onValueChange:n,children:[e.jsx(u,{className:"w-[175px] bg-[#283444] text-white  border-white  ",children:e.jsx(x,{placeholder:"سؤال المتهم"})}),e.jsxs(m,{className:"bg-[#1B2431]  text-white border-none",children:[e.jsx(a,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(a,{value:"تم",children:"تم"}),e.jsx(a,{value:"حتى الآن",children:"حتى الآن"})]})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"officerQuestion",children:"سؤال الضابط"}),e.jsxs(h,{dir:"rtl",value:k,name:"officerQuestion",onValueChange:P,children:[e.jsx(u,{className:"w-[175px] bg-[#283444] text-white  border-white  ",children:e.jsx(x,{placeholder:"سؤال المتهم"})}),e.jsxs(m,{className:"bg-[#1B2431]  text-white border-none",children:[e.jsx(a,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(a,{value:"تم",children:"تم"}),e.jsx(a,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"victimQuestion",children:"سؤال المجني عليه"}),e.jsxs(h,{dir:"rtl",value:F,name:"victimQuestion",onValueChange:s,children:[e.jsx(u,{className:"w-[175px] bg-[#283444] text-white  border-white  ",children:e.jsx(x,{placeholder:"سؤال المتهم"})}),e.jsxs(m,{className:"bg-[#1B2431]  text-white border-none",children:[e.jsx(a,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(a,{value:"تم",children:"تم"}),e.jsx(a,{value:"حتى الآن",children:"حتى الآن"})]})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"witnessQuestion",children:"سؤال الشهود"}),e.jsxs(h,{dir:"rtl",value:t,name:"witnessQuestion",onValueChange:o,children:[e.jsx(u,{className:"w-[175px] bg-[#283444] text-white  border-white  ",children:e.jsx(x,{placeholder:"سؤال المتهم"})}),e.jsxs(m,{className:"bg-[#1B2431]  text-white border-none",children:[e.jsx(a,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(a,{value:"تم",children:"تم"}),e.jsx(a,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"technicalReports",children:"التقارير الفنية"}),e.jsxs(h,{dir:"rtl",value:r,onValueChange:i,children:[e.jsx(u,{className:"w-[175px] bg-[#283444] text-white  border-white  ",children:e.jsx(x,{placeholder:"اختيار الحالة"})}),e.jsxs(m,{className:"bg-[#1B2431]  text-white border-none",children:[e.jsx(a,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(a,{value:"تم",children:"تم"}),e.jsx(a,{value:"حتى الآن",children:"حتى الآن"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"technicalReports",children:"اجراءات اخرى"}),e.jsxs(h,{dir:"rtl",value:I,onValueChange:te,children:[e.jsx(u,{className:"w-[175px] bg-[#283444] text-white  border-white  ",children:e.jsx(x,{placeholder:"اختيار الحالة"})}),e.jsxs(m,{className:"bg-[#1B2431]  text-white border-none",children:[e.jsx(a,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(a,{value:"تم",children:"تم"}),e.jsx(a,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),e.jsx(U,{type:"submit",variant:"default",className:"bg-[#4741DE] hover:bg-[#6A68FF] self-center min-w-56",children:"حفظ التعديلات"})]}),e.jsx(xe,{className:"mt-4"})]})]})},f=({children:g,contact:p})=>e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,dir:"rtl",children:g}),e.jsxs(Z,{className:"text-center",children:[e.jsx(q,{children:e.jsx(ee,{children:"المحتوى"})}),e.jsx("div",{children:p})]})]}),ve=()=>{const[g,p]=c.useState([]),[E,y]=c.useState([]),[O]=c.useState(10),[w,S]=c.useState(""),[v,D]=c.useState(""),[K,V]=c.useState(!1),{userData:j}=G(),b=j==null?void 0:j.role,T=j==null?void 0:j.id,Q=async()=>{try{const o=((await $.get("http://localhost:3000/api/private/cases")).data.cases||[]).map(r=>({...r,isReadyForDecision:!!(r.defendantQuestion&&r.officerQuestion&&r.victimQuestion&&r.witnessQuestion&&r.technicalReports&&r.caseReferral)}));p(o),y(o)}catch(s){console.error("Error fetching data:",s)}},R=()=>{S(""),D("")},M=async s=>{try{const r=((await $.get(`http://localhost:3000/api/private/cases/${s}`)).data.cases||[]).map(i=>({...i,isReadyForDecision:!!(i.defendantQuestion&&i.officerQuestion&&i.victimQuestion&&i.witnessQuestion&&i.technicalReports&&i.caseReferral)}));p(r),y(r)}catch(t){console.error("Error fetching data:",t)}};c.useEffect(()=>{b==="admin"||b==="editor"?(V(!0),b==="admin"?Q():b==="editor"&&T&&M(T)):V(!1)},[]),c.useEffect(()=>{(()=>{const t=g.filter(o=>{const r=w?o.memberNumber===w:!0,i=v?o.isReadyForDecision===(v==="نعم"):!0;return r&&i});y(t)})()},[w,v,g]);const C=c.useMemo(()=>[{accessorKey:"caseNumber",header:"رقم القضية",cell:s=>{const t=s.getValue();return e.jsx(f,{contact:t,children:e.jsx("p",{children:t})})}},{accessorKey:"memberNumber",header:"رقم العضو",cell:s=>{const t=s.getValue();return e.jsx(f,{contact:t,children:e.jsx("p",{children:t})})}},{accessorKey:"accusation",header:"التهمة",cell:s=>{const t=s.getValue();return e.jsx(f,{contact:t,children:e.jsx("p",{children:t})})}},{accessorKey:"defendantQuestion",header:"سؤال المتهم",cell:s=>{const t=s.getValue();return e.jsx(f,{contact:t,children:e.jsx("p",{children:t})})}},{accessorKey:"officerQuestion",header:"سؤال الضابط",cell:s=>{const t=s.getValue();return e.jsx(f,{contact:t,children:e.jsx("p",{children:t})})}},{accessorKey:"victimQuestion",header:"سؤال المجني عليه",cell:s=>{const t=s.getValue();return e.jsx(f,{contact:t,children:e.jsx("p",{children:t})})}},{accessorKey:"witnessQuestion",header:"سؤال الشهود",cell:s=>{const t=s.getValue();return e.jsx(f,{contact:t,children:e.jsx("p",{children:t})})}},{accessorKey:"technicalReports",header:"التقارير الفنية",cell:s=>{const t=s.getValue();return e.jsx(f,{contact:t,children:e.jsx("p",{children:t})})}},{accessorKey:"actionOther",header:"اجراءات اخرى"},{accessorKey:"isReadyForDecision",header:"جاهزة للتصرف",cell:s=>{const t=s.row.original.defendantQuestion||s.row.original.officerQuestion||s.row.original.victimQuestion||s.row.original.witnessQuestion;return[s.row.original.defendantQuestion,s.row.original.officerQuestion,s.row.original.victimQuestion,s.row.original.witnessQuestion,s.row.original.technicalReports].some(r=>r&&r.includes("حتى الآن"))?"لا":t?"نعم":"لا"}},{header:"تعديل",cell:s=>e.jsx("div",{className:"flex justify-center items-center ",children:e.jsx(je,{actionOther:s.row.original.actionOther,caseID:Number(s.row.original.id),caseNumber:s.row.original.caseNumber,memberNumber:s.row.original.memberNumber,accusation:s.row.original.accusation,defendantQuestion:s.row.original.defendantQuestion,officerQuestion:s.row.original.officerQuestion,victimQuestion:s.row.original.victimQuestion,witnessQuestion:s.row.original.witnessQuestion,technicalReports:s.row.original.technicalReports,caseReferral:s.row.original.caseReferral,isReadyForDecision:s.row.original.isReadyForDecision,children:e.jsx("img",{src:"/edit.svg",width:24,height:24,alt:""})})})}],[]),n=re({data:E,columns:C,state:{pagination:{pageIndex:0,pageSize:O}},getCoreRowModel:ue(),getPaginationRowModel:he()}),k=()=>n.nextPage(),P=()=>n.previousPage(),F=async()=>{const s=new me.Workbook,t=s.addWorksheet("Cases");t.columns=[{header:"رقم القضية",key:"caseNumber",width:20},{header:"رقم العضو",key:"memberNumber",width:20},{header:"التهمة",key:"accusation",width:30},{header:"سؤال المتهم",key:"defendantQuestion",width:30},{header:"سؤال الضابط",key:"officerQuestion",width:30},{header:"سؤال المجني عليه",key:"victimQuestion",width:30},{header:"سؤال الشهود",key:"witnessQuestion",width:30},{header:"التقارير الفنية",key:"technicalReports",width:30},{header:"إجراءات أخرى",key:"actionOther",width:20},{header:"جاهزة للتصرف",key:"isReadyForDecision",width:20}],g.forEach(B=>{t.addRow({...B,isReadyForDecision:B.isReadyForDecision?"نعم":"لا"})});const o=await s.xlsx.writeBuffer(),r=new Blob([o],{type:"application/octet-stream"}),i=window.URL.createObjectURL(r),N=document.createElement("a");N.href=i,N.download="cases.xlsx",N.click(),window.URL.revokeObjectURL(i)};return K?e.jsxs("div",{className:"flex flex-col items-center h-[110vh] space-y-4",children:[e.jsxs("div",{dir:"rtl",className:"w-[1210px] ",children:[e.jsxs("div",{className:"flex items-center self-end space-x-4 mb-4 gap-5",children:[e.jsxs(h,{dir:"rtl",value:w,onValueChange:s=>S(s),children:[e.jsx(u,{className:"w-[156px]",children:e.jsx(x,{placeholder:"رقم العضو"})}),e.jsxs(m,{children:[e.jsx(a,{value:"1",children:"1"}),e.jsx(a,{value:"2",children:"2"}),e.jsx(a,{value:"3",children:"3"}),e.jsx(a,{value:"4",children:"4"}),e.jsx(a,{value:"5",children:"5"}),e.jsx(a,{value:"6",children:"6"}),e.jsx(a,{value:"7",children:"7"}),e.jsx(a,{value:"8",children:"8"}),e.jsx(a,{value:"9",children:"9"}),e.jsx(a,{value:"10",children:"10"})]})]}),e.jsxs(h,{dir:"rtl",value:v,onValueChange:s=>D(s),children:[e.jsx(u,{className:"w-[156px]",children:e.jsx(x,{placeholder:" جاهزة للتصرف"})}),e.jsxs(m,{children:[e.jsx(a,{value:"نعم",children:"نعم"}),e.jsx(a,{value:"لا",children:"لا"})]})]}),e.jsx(U,{className:"bg-purple-700 hover:bg-purple-500",onClick:R,children:"مسح الفلاتر"}),e.jsx(U,{onClick:F,className:"bg-green-500 hover:bg-green-400",children:"تصدير إلى أكسل"})]}),e.jsxs(ce,{className:" overflow-hidden",children:[e.jsx(ie,{children:n.getHeaderGroups().map(s=>e.jsx(W,{className:"text-center",children:s.headers.map(t=>e.jsx(le,{className:"text-center",children:J(t.column.columnDef.header,t.getContext())},t.id))},s.id))}),e.jsx(ne,{children:n.getRowModel().rows.map(s=>e.jsx(W,{children:s.getVisibleCells().map(t=>e.jsx(oe,{className:"text-center align-middle truncate max-w-[150px]",children:J(t.column.columnDef.cell,t.getContext())},t.id))},s.id))}),e.jsx(de,{})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:P,disabled:!n.getCanPreviousPage(),className:"border rounded p-2",children:"السابق"}),n.getPageOptions().map(s=>e.jsx("button",{onClick:()=>n.setPageIndex(s),className:`border rounded p-2 ${n.getState().pagination.pageIndex===s?"bg-purple-500 text-white":""}`,children:s+1},s)),e.jsx("button",{onClick:k,disabled:!n.getCanNextPage(),className:"border rounded p-2",children:"التالي"})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center h-screen",children:e.jsx("p",{className:"text-2xl text-red-500",children:"غير مصرح لك بالاطلاع على البيانات."})})};export{ve as default};
