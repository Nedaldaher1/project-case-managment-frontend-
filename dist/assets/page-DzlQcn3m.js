import{r,u as Z,j as e,I as y,B as W,d as X,_ as z}from"./index-DuPbkBlM.js";import{u as ee,T as ae,a as te,b as Y,c as se,f as J,d as re,e as le,g as ne,h as ie}from"./index-D_kfmhOx.js";import{D as oe,a as ce,b as de,E as ue}from"./exceljs.min-Cgt3dj46.js";import{S as P,a as M,b as K,c as A,d}from"./select-C4qD4X4P.js";import{A as q,m as Q}from"./proxy-CJ9Tpz7V.js";const me=({children:R,id:V,type_case:w,defendantName:T,imprisonmentDuration:u,startDate:b,issuingDepartment:x,case_Number:B,year:N,investigationID:G,officeNumber:E})=>{const[F,p]=r.useState(!1),[v,f]=r.useState(B),[D,S]=r.useState(T),[h,C]=r.useState(b?new Date(b):null),[j,$]=r.useState(u?parseInt(u.toString()):void 0),[O,H]=r.useState(x),[k,_]=r.useState(N),[I,a]=r.useState(G),[t,i]=r.useState(w),[m,c]=r.useState(E),{userData:o}=Z(),n=o==null?void 0:o.member_id,g={1:"الأولى",2:"الثانية",3:"الثالثة",4:"الرابعة",5:"الخامسة",6:"السادسة",7:"السابعة",8:"الثامنة",9:"التاسعة",10:"العاشرة",11:"الحادية عشرة",12:"الثانية عشرة",13:"الثالثة عشرة",14:"الرابعة عشرة",15:"الخامسة عشرة",16:"السادسة عشرة",17:"السابعة عشرة",18:"الثامنة عشرة",19:"التاسعة عشرة",20:"العشرون"},L=async s=>{s.preventDefault();const l={id:V,year:new Date().getFullYear().toString()};if(v&&(l.caseNumber=v),D&&(l.defendantName=D),h&&(l.startDate=h),j&&(l.imprisonmentDuration=j),O&&(l.issuingDepartment=O),t&&(l.type_case=t),I&&(l.investigationID=I),k&&(l.year=k),m&&(l.officeNumber=m),n&&(l.member_number=n.toString()),Object.keys(l).length>1)try{const U=await X.put("http://localhost:3000/api/public/cases/edit",l);console.log(U),z.success("تم التحديث بنجاح!")}catch(U){z.error("فشلت عملية التحديث"),console.error("Error updating case:",U)}else z.error("يرجى ملء حقل واحد على الأقل للتحديث")};return e.jsx(q,{children:e.jsxs(oe,{open:F,onOpenChange:p,children:[e.jsx(ce,{asChild:!0,children:R}),e.jsx(q,{children:F&&e.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(Q.div,{initial:{scale:.8},animate:{scale:1},className:"bg-white rounded-2xl shadow-xl p-8 border border-blue-100 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(de,{children:e.jsx("h2",{className:"text-2xl font-bold mb-6 text-center text-blue-600",children:"تعديل بيانات القضية"})}),e.jsxs("form",{onSubmit:L,className:"space-y-8",children:[e.jsxs("fieldset",{className:"border-2 border-blue-100 rounded-xl p-6 text-right",children:[e.jsx("legend",{className:"px-2 text-xl font-semibold text-blue-600",children:"بيانات القضية"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"رقم القضية"}),e.jsx(y,{value:v,name:"caseNumber",onChange:s=>f(s.target.value),className:"w-full border-blue-200 rounded-xl bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:" السنة"}),e.jsx(y,{type:"number",value:k,onChange:s=>_(s.target.value),className:"border-blue-200 focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"نوع القضية"}),e.jsxs(P,{value:t,onValueChange:s=>i(s),children:[e.jsx(M,{className:"w-full border-blue-200 rounded-xl bg-white",children:e.jsx(K,{placeholder:"اختر النوع"})}),e.jsxs(A,{children:[e.jsx(d,{value:"جنحة",children:"جنحة"}),e.jsx(d,{value:"جناية",children:"جناية"}),e.jsx(d,{value:"اداري",children:"اداري"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"رقم حصر التحقيق"}),e.jsx(y,{type:"text",value:I,onChange:s=>a(s.target.value),className:"border-blue-200 focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"اسم المتهم"}),e.jsx(y,{value:D,name:"accusedName",onChange:s=>S(s.target.value),className:"w-full border-blue-200 rounded-xl bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"رقم العضو"}),e.jsxs(P,{value:n==null?void 0:n.toString(),disabled:!0,children:[e.jsx(M,{className:"w-full border-blue-200 rounded-xl bg-white",children:e.jsx(K,{placeholder:"رقم العضو"})}),e.jsx(A,{children:[...Array(10)].map((s,l)=>e.jsx(d,{value:`${l+1}`,children:l+1},l+1))})]})]})]})]}),e.jsxs("fieldset",{className:"border-2 border-blue-100 rounded-xl p-6 text-right",children:[e.jsx("legend",{className:"px-2 text-xl font-semibold text-blue-600",children:"معلومات التجديد"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"تاريخ البداية"}),e.jsx(y,{type:"date",value:h?h.toISOString().split("T")[0]:"",onChange:s=>C(new Date(s.target.value)),className:"w-full border-blue-200 rounded-xl bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"مدة الحبس (أيام)"}),e.jsx(y,{type:"number",min:"1",value:j,onChange:s=>$(parseInt(s.target.value)),className:"w-full border-blue-200 rounded-xl bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"دائرة مصدرة القرار"}),e.jsxs(P,{value:x,onValueChange:H,children:[e.jsx(M,{className:"border-blue-200 focus:ring-2 focus:ring-indigo-500",children:e.jsx(K,{placeholder:"اختر الدائرة"})}),e.jsxs(A,{children:[e.jsx(d,{value:"جزئي",children:"جزئي"}),e.jsx(d,{value:"مستأنف",children:"مستأنف"}),e.jsx(d,{value:"جنايات",children:"جنايات"}),e.jsx(d,{value:"رئيس نيابة",children:"رئيس نيابة"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"رقم الدائرة"}),e.jsxs(P,{value:E,onValueChange:c,children:[e.jsx(M,{className:"border-blue-200 focus:ring-2 focus:ring-indigo-500",children:e.jsx(K,{placeholder:"اختر الرقم"})}),e.jsx(A,{children:Array.from({length:20},(s,l)=>l+1).map(s=>e.jsx(d,{value:g[s],children:g[s]},s))})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(W,{type:"button",onClick:()=>p(!1),variant:"outline",className:"px-6 py-2 border-gray-300",children:"إلغاء"}),e.jsx(W,{type:"submit",className:"bg-indigo-600 hover:bg-indigo-700 px-6 py-2",children:"حفظ التغييرات"})]})]})]})})})]})})},fe=()=>{const[R,V]=r.useState([]),[w,T]=r.useState([]),[u,b]=r.useState(1),[x,B]=r.useState(20),[N,G]=r.useState(1),[E,F]=r.useState(0),[p,v]=r.useState(""),[f,D]=r.useState(""),[S,h]=r.useState(!0),[C,j]=r.useState(""),[$,O]=r.useState(""),H=async(a=1)=>{try{h(!0);const t=await X.get("http://localhost:3000/api/public/cases",{params:{page:a,pageSize:x}}),{cases:i,total:m,totalPages:c}=t.data;V(i),T(i),G(c),F(m),j("")}catch{j("فشل في جلب البيانات")}finally{h(!1)}};r.useEffect(()=>{H(u)},[u,x]),r.useEffect(()=>{(()=>{const t=R.filter(i=>{const m=i.caseNumber.toLowerCase().includes(p.toLowerCase());let c=!0;if(f)try{const o=new Date(i.startDate),n=new Date(o);n.setDate(o.getDate()+(i.imprisonmentDuration||0)-1),c=n.toISOString().split("T")[0]===new Date(f).toISOString().split("T")[0]}catch{c=!1}return m&&c});T(t)})()},[p,f,R]);const k=r.useMemo(()=>[{accessorKey:"id",header:"رقم مسلسل"},{accessorKey:"caseNumber",header:"رقم القضية"},{accessorKey:"year",header:"السنة"},{accessorKey:"type_case",header:"نوع القضية"},{accessorKey:"investigationID",header:"رقم حصر التحقيق"},{accessorKey:"defendantName",header:"اسم المتهم"},{accessorKey:"member_number",header:"رقم العضو"},{accessorKey:"startDate",header:"بداية المدة",cell:a=>new Date(a.getValue()).toLocaleDateString("ar-EG")},{accessorKey:"imprisonmentDuration",header:"مدة الحبس"},{header:"موعد التجديد",cell:a=>{try{const t=new Date(a.row.original.startDate),i=new Date(t);return i.setDate(t.getDate()+(a.row.original.imprisonmentDuration||0)-1),O(i.toLocaleDateString("ar-EG")),i.toLocaleDateString("ar-EG")}catch{return"تاريخ غير صحيح"}}},{accessorKey:"issuingDepartment",header:"دائرة اصدار القرار"},{accessorKey:"officeNumber",header:"رقم الدائرة"},{header:"تعديل",cell:a=>e.jsx("div",{className:"flex justify-center items-center w-[50px]",children:e.jsx(me,{id:Number(a.row.original.id),case_Number:a.row.original.caseNumber,defendantName:a.row.original.defendantName,imprisonmentDuration:a.row.original.imprisonmentDuration,startDate:new Date(a.row.original.startDate),memberNumber:a.row.original.member_number,type_case:a.row.original.type_case,year:a.row.original.year,issuingDepartment:a.row.original.issuingDepartment,investigationID:a.row.original.investigationID,officeNumber:a.row.original.officeNumber,children:e.jsx("img",{src:"/edit.svg",width:24,height:24,alt:"تعديل"})})})}],[]),_=ee({data:w,columns:k,state:{pagination:{pageIndex:0,pageSize:x}},getCoreRowModel:ie(),getPaginationRowModel:ne()}),I=async()=>{try{const a=new ue.Workbook,t=a.addWorksheet("القضايا");t.columns=[{header:"رقم مسلسل",key:"id",width:15},{header:"رقم القضية",key:"caseNumber",width:20},{header:"السنة",key:"year",width:20},{header:"نوع القضية",key:"type_case",width:20},{header:"رقم حصر التحقيق",key:"investigationID",width:20},{header:"اسم المتهم",key:"defendantName",width:20},{header:"رقم العضو",key:"member_number",width:15},{header:"بداية المدة",key:"startDate",width:20},{header:"مدة الحبس",key:"imprisonmentDuration",width:15},{header:"موعد التجديد",key:"renewalDate",width:20},{header:"دائرة مصدر القرار",key:"issuingDepartment",width:20},{header:"رقم الدائرة",key:"officeNumber",width:20}],t.getRow(1).font={bold:!0,color:{argb:"FFFFFFFF"}},t.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF2D9596"}},w.forEach(n=>{const g=new Date(n.startDate),L=new Date(g);n.imprisonmentDuration&&L.setDate(g.getDate()+parseInt(n.imprisonmentDuration.toString()||"0")-1);const s={year:"numeric",month:"2-digit",day:"2-digit",numberingSystem:"arab"};t.addRow({...n,startDate:g.toLocaleDateString("ar-EG",s),renewalDate:L.toLocaleDateString("ar-EG",s)})}),t.eachRow((n,g)=>{n.alignment={vertical:"middle",horizontal:"right"},g>1&&(n.font={name:"Arial Arabic",size:12})});const i=await a.xlsx.writeBuffer(),m=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=`القضايا_${new Date().toISOString().split("T")[0]}.xlsx`,o=document.createElement("a");o.href=URL.createObjectURL(m),o.download=c,o.click(),URL.revokeObjectURL(o.href)}catch(a){console.error("فشل التصدير:",a),z.error("فشل في تصدير الملف")}};return e.jsx("div",{dir:"rtl",className:"flex flex-col items-center min-h-screen p-4 bg-gray-50",children:e.jsxs("div",{className:"w-full max-w-6xl space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex gap-4 flex-1",children:[e.jsx("input",{type:"text",placeholder:"رقم القضية",value:p,onChange:a=>v(a.target.value),className:"border rounded-lg p-2 w-full max-w-xs focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"date",value:f,onChange:a=>D(a.target.value),className:"border rounded-lg p-2 w-full max-w-xs focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("button",{onClick:I,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx("span",{children:"تصدير إلى أكسل"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})})]})]}),S&&e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"animate-spin inline-block w-8 h-8 border-4 border-blue-500 rounded-full border-t-transparent"}),e.jsx("p",{className:"mt-2 text-blue-600",children:"جاري التحميل..."})]}),C&&e.jsx("div",{className:"bg-red-100 p-4 rounded-lg text-red-700 text-center",children:C}),!S&&!C&&e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs(ae,{className:"w-full",children:[e.jsx(te,{className:"bg-gray-50",children:_.getHeaderGroups().map(a=>e.jsx(Y,{children:a.headers.map(t=>e.jsx(se,{className:"px-4 py-3 text-right font-semibold text-gray-700 border-b",children:J(t.column.columnDef.header,t.getContext())},t.id))},a.id))}),e.jsx(re,{children:_.getRowModel().rows.map(a=>e.jsx(Y,{className:"hover:bg-gray-50 transition-colors even:bg-gray-50",children:a.getVisibleCells().map(t=>e.jsx(le,{className:"text-center p-3 border-t border-gray-100",children:J(t.column.columnDef.cell,t.getContext())},t.id))},a.id))})]}),w.length===0&&!S&&e.jsx("div",{className:"p-6 text-center text-gray-500",children:"لا توجد بيانات متطابقة مع عوامل التصفية"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(a=>Math.max(a-1,1)),disabled:u===1,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg disabled:bg-gray-300",children:"السابق"}),e.jsx("button",{onClick:()=>b(a=>Math.min(a+1,N)),disabled:u===N,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg disabled:bg-gray-300",children:"التالي"})]}),e.jsxs("div",{className:"text-gray-700",children:["الصفحة ",u," من ",N," (إجمالي القضايا: ",E,")"]}),e.jsxs("select",{value:x,onChange:a=>{B(Number(a.target.value)),b(1)},className:"border rounded-lg p-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:10,children:"10 لكل صفحة"}),e.jsx("option",{value:20,children:"20 لكل صفحة"}),e.jsx("option",{value:50,children:"50 لكل صفحة"}),e.jsx("option",{value:100,children:"100 لكل صفحة"})]})]})]})})};export{fe as default};
