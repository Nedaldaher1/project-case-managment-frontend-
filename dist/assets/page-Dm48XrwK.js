import{r as a,u as ve,j as e,B as j,I as n,d as f,_ as u}from"./index-DuPbkBlM.js";import{r as be,u as fe}from"./xlsx-fdabpkSu.js";import{X as ye,P as Ne}from"./progress-B5vEx7DL.js";import{S as i,a as d,b as o,c as x,d as t}from"./select-C4qD4X4P.js";import{A as Se,m as xe}from"./proxy-CJ9Tpz7V.js";const Ve=()=>{const[w,A]=a.useState(""),[q,I]=a.useState(0),[V,E]=a.useState(""),[P,Q]=a.useState(""),[R,F]=a.useState(""),{userData:h}=ve(),T=h==null?void 0:h.member_id,$=h==null?void 0:h.id,[O,_]=a.useState(""),[B,D]=a.useState(""),[U,z]=a.useState(""),[g,M]=a.useState(""),[W,X]=a.useState(""),[Y,G]=a.useState(""),[H,J]=a.useState(""),[K,L]=a.useState(""),[Z,ue]=a.useState(""),[he,p]=a.useState(!1),[me,ee]=a.useState(0),[se,te]=a.useState(0),[ae,le]=a.useState(0),[re,v]=a.useState(!1),[y,ce]=a.useState(null),[ne,N]=a.useState(!1),je=async l=>{var r;l.preventDefault();try{const c=await f.post("http://localhost:3000/api/private/cases/add",{caseNumber:w,year:q,officerQuestion:H,caseType:V,investigationID:P,accusedName:R,accusation:Z,memberNumber:T,defendantQuestion:O,victimQuestion:B,witnessQuestion:U,actionOther:K,technicalReports:g,...g==="حتى الآن"&&{reportType:W},readyForAction:Y,userId:$});A(""),I(0),E(""),Q(""),F(""),_(""),D(""),z(""),M(""),X(""),G(""),J(""),L(""),c.data.success?u.success("تم إضافة القضية بنجاح"):u.error("فشلت عملية إضافة القضية")}catch(c){c instanceof Error?f.isAxiosError(c)?u.error(((r=c.response)==null?void 0:r.data.message)||c.message):u.error("An unknown error occurred"):console.error("An unknown error occurred")}},ge=async l=>{const r=new FileReader;r.onload=async c=>{var ie,de;try{const b=new Uint8Array((ie=c.target)==null?void 0:ie.result),oe=be(b,{type:"array"}),pe=oe.Sheets[oe.SheetNames[0]],S=fe.sheet_to_json(pe).map(s=>{if(!s["رقم القضية"]||!s["اسم المتهم"]||!s["رقم العضو"])throw new Error("بيانات ناقصة في أحد الصفوف");return{caseNumber:s["رقم القضية"],year:s.السنة,investigationID:s["رقم حصر التحقيق"],accusedName:s["اسم المتهم"],accusation:s.التهمة,memberNumber:s["رقم العضو"],defendantQuestion:s["سؤال المتهم"],victimQuestion:s["سؤال المجني عليه"],witnessQuestion:s["سؤال الشهود"],officerQuestion:s["سؤال الضابط"],technicalReports:s["التقارير الفنية"],reportType:s["نوع التقرير"],actionOther:s["إجراءات أخرى"],userId:$}});v(!0);let k=0,C=0;for(let s=0;s<S.length;s++){try{await f.post("http://localhost:3000/api/private/cases/add",S[s],{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),k++}catch(m){C++,f.isAxiosError(m)?console.error(`خطأ في الصف ${s+1}:`,((de=m.response)==null?void 0:de.data)||m.message):console.error(`خطأ في الصف ${s+1}:`,m)}ee((s+1)/S.length*100),te(k),le(C),await new Promise(m=>setTimeout(m,100))}v(!1),N(!0),ce(null),u.success(`تم استيراد ${k} قضية بنجاح مع ${C} أخطاء`)}catch(b){b instanceof Error?u.error(b.message||"حدث خطأ في معالجة الملف"):u.error("حدث خطأ في معالجة الملف"),v(!1)}},r.readAsArrayBuffer(l)};return e.jsx("div",{dir:"rtl",className:"min-h-screen bg-gradient-to-b from-blue-50 to-indigo-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"  h-[70px] text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"إضافة قضية جديدة"}),e.jsx(j,{onClick:()=>p(!0),className:"bg-green-600 hover:bg-green-700",children:"استيراد من Excel"})]}),e.jsx(Se,{children:(he||ne)&&e.jsx(xe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(xe.div,{initial:{scale:.8},animate:{scale:1},className:"bg-white rounded-2xl shadow-xl p-8 border border-blue-100 w-full max-w-2xl relative",children:[e.jsx("button",{onClick:()=>{p(!1),N(!1),ee(0),te(0),le(0)},className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",children:e.jsx(ye,{className:"h-6 w-6"})}),!re&&!ne?e.jsxs("div",{className:"space-y-6",children:[e.jsx(n,{type:"file",accept:".xlsx, .xls",onChange:l=>{var r;return ce(((r=l.target.files)==null?void 0:r[0])||null)}}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(j,{variant:"outline",onClick:()=>p(!1),children:"إلغاء"}),e.jsx(j,{disabled:!y,onClick:()=>y&&ge(y),children:"بدء الاستيراد"})]})]}):e.jsx("div",{className:"space-y-6 text-center",children:re?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{value:me,className:"h-3"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-green-600",children:["الناجحة: ",se]}),e.jsxs("div",{className:"text-red-600",children:["خطأ: ",ae]})]}),e.jsx(j,{variant:"destructive",onClick:()=>v(!1),children:"إيقاف الاستيراد"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"نتيجة الاستيراد"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"bg-green-100 p-4 rounded-lg",children:[e.jsx("span",{className:"text-green-700 font-bold",children:se}),e.jsx("p",{className:"text-sm",children:"استيراد ناجح"})]}),e.jsxs("div",{className:"bg-red-100 p-4 rounded-lg",children:[e.jsx("span",{className:"text-red-700 font-bold",children:ae}),e.jsx("p",{className:"text-sm",children:"خطأ"})]})]}),e.jsx(j,{onClick:()=>{N(!1),p(!1)},className:"mt-4",children:"إغلاق"})]})})]})})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-blue-100",children:e.jsxs("form",{onSubmit:je,className:"space-y-8",children:[e.jsxs("fieldset",{className:"border-2 border-blue-100 rounded-xl p-6",children:[e.jsx("legend",{className:"px-2 text-xl font-semibold text-blue-600",children:"بيانات القضية"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"رقم القضية"}),e.jsx(n,{type:"text",value:w,onChange:l=>A(l.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"السنة"}),e.jsx(n,{type:"number",value:q,onChange:l=>I(Number(l.target.value)),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"نوع القضية"}),e.jsxs(i,{value:V,onValueChange:E,required:!0,children:[e.jsx(d,{children:e.jsx(o,{placeholder:"اختر النوع"})}),e.jsxs(x,{children:[e.jsx(t,{value:"جنحة",children:"جنحة"}),e.jsx(t,{value:"جناية",children:"جناية"}),e.jsx(t,{value:"إداري",children:"إداري"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"رقم حصر التحقيق"}),e.jsx(n,{type:"text",value:P,onChange:l=>Q(l.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:" التهمة "}),e.jsx(n,{type:"text",value:Z,onChange:l=>ue(l.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"اسم المتهم"}),e.jsx(n,{type:"text",value:R,onChange:l=>F(l.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"رقم العضو"}),e.jsx(n,{type:"text",value:T||"",disabled:!0})]})]})]}),e.jsxs("fieldset",{className:"border-2 border-blue-100 rounded-xl p-6",children:[e.jsx("legend",{className:"px-2 text-xl font-semibold text-blue-600",children:"الإجراءات"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"سؤال المتهم"}),e.jsxs(i,{value:O,onValueChange:_,required:!0,children:[e.jsx(d,{children:e.jsx(o,{placeholder:"اختر الحالة"})}),e.jsxs(x,{children:[e.jsx(t,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(t,{value:"تم",children:"تم"}),e.jsx(t,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"سؤال المجني عليه"}),e.jsxs(i,{value:B,onValueChange:D,required:!0,children:[e.jsx(d,{children:e.jsx(o,{placeholder:"اختر الحالة"})}),e.jsxs(x,{children:[e.jsx(t,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(t,{value:"تم",children:"تم"}),e.jsx(t,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"سؤال الشهود"}),e.jsxs(i,{value:U,onValueChange:z,required:!0,children:[e.jsx(d,{children:e.jsx(o,{placeholder:"اختر الحالة"})}),e.jsxs(x,{children:[e.jsx(t,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(t,{value:"تم",children:"تم"}),e.jsx(t,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"سؤال الظابط "}),e.jsxs(i,{value:H,onValueChange:J,required:!0,children:[e.jsx(d,{children:e.jsx(o,{placeholder:"اختر الحالة"})}),e.jsxs(x,{children:[e.jsx(t,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(t,{value:"تم",children:"تم"}),e.jsx(t,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"تقارير فنية"}),e.jsxs(i,{value:g,onValueChange:M,required:!0,children:[e.jsx(d,{children:e.jsx(o,{placeholder:"اختر الحالة"})}),e.jsxs(x,{children:[e.jsx(t,{value:"تم",children:"تم"}),e.jsx(t,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(t,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),g==="حتى الآن"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"نوع التقرير"}),e.jsx(n,{type:"text",value:W,onChange:l=>X(l.target.value),required:g==="حتى الآن"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"اجراءات اخرى"}),e.jsxs(i,{value:K,onValueChange:L,required:!0,children:[e.jsx(d,{children:e.jsx(o,{placeholder:"اختر الحالة"})}),e.jsxs(x,{children:[e.jsx(t,{value:"تم",children:"تم"}),e.jsx(t,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(t,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"جاهزة للتصرف"}),e.jsxs(i,{value:Y,onValueChange:G,required:!0,children:[e.jsx(d,{children:e.jsx(o,{placeholder:"اختر الحالة"})}),e.jsxs(x,{children:[e.jsx(t,{value:"نعم",children:"نعم"}),e.jsx(t,{value:"لا",children:"لا"})]})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(j,{type:"submit",className:"mt-6 bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-xl text-lg",children:"إضافة القضية"})})]})})]})})};export{Ve as default};
