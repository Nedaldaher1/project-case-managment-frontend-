import{r as l,u as O,j as e,I as S,B as V,b as B,_ as F}from"./index-mz9mZwsC.js";import{u as A,T as G,a as H,b as P,c as U,f as K,d as $,e as z,h as W,i as J}from"./index-Du1KXNz1.js";import{D as q,a as Q,b as X,c as Y,d as Z,e as ee,E as ae}from"./exceljs.min-B4EiSvJd.js";import{S as T,a as L,b as I,c as M,d as r}from"./select-BbpFdzmn.js";const te=({children:j,id:C,type_case:p,defendantName:f,imprisonmentDuration:D,startDate:k,member_Location:b,case_Number:E})=>{const[m,R]=l.useState(E),[g,N]=l.useState(f),[h,y]=l.useState(k?new Date(k):null),[w,_]=l.useState(D?parseInt(D.toString()):void 0),[u,v]=l.useState(b),[a,t]=l.useState(p),{userData:o}=O(),d=o==null?void 0:o.member_id,x=async c=>{c.preventDefault();const s={id:C};if(m&&(s.caseNumber=m),g&&(s.defendantName=g),h&&(s.startDate=h),w&&(s.imprisonmentDuration=w),u&&(s.member_location=u),a&&(s.type_case=a),d&&(s.member_number=d.toString()),Object.keys(s).length>1)try{const n=await B.put("http://localhost:3000/api/public/cases/edit",s);console.log(n),F.success("تم التحديث بنجاح!")}catch(n){F.error("فشلت عملية التحديث"),console.error("Error updating case:",n)}else F.error("يرجى ملء حقل واحد على الأقل للتحديث")},i=c=>{const{name:s,value:n}=c.target;switch(s){case"caseNumber":R(n);break;case"accusedName":N(n);break;case"caseDate":y(new Date(n));break;case"casePrisonDate":_(parseInt(n));break;case"memberLocation":v(n);break}};return e.jsxs(q,{children:[e.jsx(Q,{asChild:!0,children:j}),e.jsxs(X,{dir:"rtl",className:"bg-[#1B2431] text-white border-none",children:[e.jsx(Y,{children:e.jsx(Z,{children:"تعديل القضية"})}),e.jsxs("form",{onSubmit:x,className:"space-y-4 flex flex-col justify-center",children:[e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"caseNumber",children:"رقم القضية"}),e.jsx(S,{value:m,name:"caseNumber",onChange:i,type:"text",min:"1",placeholder:"رقم القضية",className:"bg-[#273142] text-white w-full"})]}),e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"accusedName",children:"اسم المتهم"}),e.jsx(S,{value:g,name:"accusedName",onChange:i,type:"text",placeholder:"اسم المتهم",className:"bg-[#273142] text-white w-full"})]}),e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"caseDate",children:"مدة البداية"}),e.jsx(S,{value:h?h.toISOString().split("T")[0]:"",name:"caseDate",onChange:i,type:"date",placeholder:"بداية الحبس",className:"bg-[#273142] text-white w-full"})]}),e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"casePrisonDate",children:"مدة الحبس"}),e.jsx(S,{value:w,name:"casePrisonDate",onChange:i,type:"number",min:"1",placeholder:"مدة الحبس",className:"bg-[#273142] text-white w-full"})]}),e.jsxs("div",{dir:"rtl",className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{className:" text-white text-sm",htmlFor:"caseRenewalDate",children:"مكان العضو"}),e.jsxs(T,{disabled:!0,value:d?d.toString():"",children:[e.jsx(L,{className:"bg-[#273142] text-white w-full",children:e.jsx(I,{placeholder:"رقم العضو"})}),e.jsxs(M,{children:[e.jsx(r,{value:"1",children:"1"}),e.jsx(r,{value:"2",children:"2"}),e.jsx(r,{value:"3",children:"3"}),e.jsx(r,{value:"4",children:"4"}),e.jsx(r,{value:"5",children:"5"}),e.jsx(r,{value:"6",children:"6"}),e.jsx(r,{value:"7",children:"7"}),e.jsx(r,{value:"8",children:"8"}),e.jsx(r,{value:"9",children:"9"}),e.jsx(r,{value:"10",children:"10"})]})]})]}),e.jsxs("div",{dir:"rtl",className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{className:" text-white text-sm",htmlFor:"caseRenewalDate",children:"مكان التجديد"}),e.jsxs(T,{value:u,onValueChange:c=>v(c),children:[e.jsx(L,{className:"bg-[#273142] text-white w-full",children:e.jsx(I,{placeholder:"مكان التجديد"})}),e.jsxs(M,{children:[e.jsx(r,{value:"جزئي",children:"جزئي"}),e.jsx(r,{value:"مستأنف",children:"مستأنف"}),e.jsx(r,{value:"جنايات",children:"جنايات"}),e.jsx(r,{value:"رئيس نيابة",children:"رئيس نيابة"})]})]})]}),e.jsxs("div",{dir:"rtl",className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{className:" text-white text-sm",htmlFor:"caseRenewalDate",children:"نوع القضية"}),e.jsxs(T,{dir:"rtl",value:a,onValueChange:c=>t(c),children:[e.jsx(L,{className:"bg-[#273142] text-white w-full",children:e.jsx(I,{placeholder:"نوع القضية"})}),e.jsxs(M,{children:[e.jsx(r,{value:"جنحة ",children:"جنحة "}),e.jsx(r,{value:"جناية  ",children:"جناية  "}),e.jsx(r,{value:"اداري ",children:"اداري "})]})]})]}),e.jsx(V,{type:"submit",variant:"default",className:"bg-[#4741DE] hover:bg-[#6A68FF] self-center min-w-56",children:"حفظ التعديلات"})]}),e.jsx(ee,{className:"mt-4"})]})]})},ne=()=>{const[j,C]=l.useState([]),[p,f]=l.useState([]),[D,k]=l.useState(10),[b,E]=l.useState(""),[m,R]=l.useState(""),[g,N]=l.useState(!0),[h,y]=l.useState(""),w=async()=>{try{N(!0);const a=await B.get("http://localhost:3000/api/public/cases");console.log("API Response:",a.data);const t=a.data.cases||[];console.log("Processed Cases:",t),C(t),f(t),y("")}catch(a){console.error("Error fetching data:",a),y("فشل في جلب البيانات")}finally{N(!1)}};l.useEffect(()=>{w()},[]),l.useEffect(()=>{(()=>{console.log("Filtering with:",{caseNumberFilter:b,dateFilter:m});const t=j.filter(o=>{const d=o.caseNumber.toLowerCase().includes(b.toLowerCase());let x=!0;if(m)try{const i=new Date(o.startDate),c=new Date(i);c.setDate(i.getDate()+(o.imprisonmentDuration||0)-1);const s=c.toISOString().split("T")[0],n=new Date(m).toISOString().split("T")[0];x=s===n}catch(i){console.error("Invalid date processing:",i),x=!1}return d&&x});console.log("Filtered Results:",t),f(t)})()},[b,m,j]);const _=l.useMemo(()=>[{accessorKey:"id",header:"رقم مسلسل"},{accessorKey:"defendantName",header:"اسم المتهم"},{accessorKey:"imprisonmentDuration",header:"مدة الحبس"},{accessorKey:"startDate",header:"بداية المدة",cell:a=>{const t=a.getValue();return console.log("startDate value:",t),new Date(t).toLocaleDateString("ar-EG")}},{header:"موعد التجديد",cell:a=>{try{const t=new Date(a.row.original.startDate),o=a.row.original.imprisonmentDuration||0,d=new Date(t);return d.setDate(t.getDate()+o-1),d.toLocaleDateString("ar-EG")}catch(t){return console.error("Error calculating renewal date:",t),"تاريخ غير صحيح"}}},{accessorKey:"member_location",header:"مكان التجديد"},{accessorKey:"member_number",header:"رقم العضو"},{accessorKey:"type_case",header:"نوع القضية"},{accessorKey:"caseNumber",header:"رقم القضية"},{header:"تعديل",cell:a=>e.jsx("div",{className:"flex justify-center items-center w-[50px]",children:e.jsx(te,{id:Number(a.row.original.id),case_Number:a.row.original.caseNumber,defendantName:a.row.original.defendantName,imprisonmentDuration:a.row.original.imprisonmentDuration,startDate:new Date(a.row.original.startDate),member_Location:a.row.original.member_location,memberNumber:a.row.original.member_number,type_case:a.row.original.type_case,children:e.jsx("img",{src:"/edit.svg",width:24,height:24,alt:""})})})}],[]),u=A({data:p,columns:_,state:{pagination:{pageIndex:0,pageSize:D}},getCoreRowModel:J(),getPaginationRowModel:W()});console.log("Table State:",{rows:u.getRowModel().rows,columns:u.getAllColumns(),filteredData:p});const v=async()=>{try{const a=new ae.Workbook,t=a.addWorksheet("Cases");t.columns=[{header:"رقم مسلسل",key:"id",width:15},{header:"اسم المتهم",key:"defendantName",width:20},{header:"مدة الحبس",key:"imprisonmentDuration",width:15},{header:"بداية المدة",key:"startDate",width:20},{header:"موعد التجديد",key:"renewalDate",width:20},{header:"مكان التجديد",key:"member_location",width:20},{header:"رقم العضو",key:"member_number",width:15},{header:"نوع القضية",key:"type_case",width:20},{header:"رقم القضية",key:"caseNumber",width:20}],p.forEach(c=>{try{const s=new Date(c.startDate),n=new Date(s);n.setDate(s.getDate()+(c.imprisonmentDuration||0)-1),t.addRow({...c,startDate:s.toLocaleDateString("ar-EG"),renewalDate:n.toLocaleDateString("ar-EG")})}catch(s){console.error("Error exporting row:",c,s)}});const o=await a.xlsx.writeBuffer(),d=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),x=URL.createObjectURL(d),i=document.createElement("a");i.href=x,i.download="Cases.xlsx",i.click(),URL.revokeObjectURL(x)}catch(a){console.error("Export failed:",a),alert("فشل التصدير")}};return e.jsx("div",{className:"flex flex-col items-center h-[110vh] space-y-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex items-center self-end space-x-4 mb-4",children:[e.jsx("button",{onClick:v,className:"bg-green-500 text-white px-4 py-2 rounded",children:"تصدير إلى أكسل"}),e.jsx("input",{type:"text",placeholder:"رقم القضية",value:b,onChange:a=>E(a.target.value),className:"border rounded p-2"}),e.jsx("input",{type:"date",value:m,onChange:a=>R(a.target.value),className:"border rounded p-2"})]}),g&&e.jsx("p",{className:"text-blue-500",children:"جاري التحميل..."}),h&&e.jsx("p",{className:"text-red-500",children:h}),!g&&!h&&e.jsxs("div",{className:"w-[1110px]",children:[e.jsxs(G,{className:"overflow-hidden",children:[e.jsx(H,{children:u.getHeaderGroups().map(a=>e.jsx(P,{children:a.headers.map(t=>e.jsx(U,{children:K(t.column.columnDef.header,t.getContext())},t.id))},a.id))}),e.jsx($,{children:u.getRowModel().rows.map(a=>(console.log("Rendering row:",a.original),e.jsx(P,{children:a.getVisibleCells().map(t=>{const o=t.getValue();return console.log(`Cell [${t.id}]:`,o),e.jsx(z,{children:K(t.column.columnDef.cell,t.getContext())},t.id)})},a.id)))})]}),p.length===0&&!g&&e.jsx("p",{className:"text-center my-4",children:"لا توجد بيانات متطابقة مع عوامل التصفية"})]})]})})};export{ne as default};
