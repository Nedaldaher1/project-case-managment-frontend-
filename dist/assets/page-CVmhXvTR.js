import{n as D,r as o,p as te,d as z,j as e,B as V,_ as B}from"./index-DuPbkBlM.js";import{u as H,w as ae}from"./xlsx-fdabpkSu.js";import{u as se,T as le,a as re,b as q,e as M,c as ne,f as $,d as oe,g as ie,h as ce}from"./index-D_kfmhOx.js";import{S as F,a as O,b as U,c as P,d as x}from"./select-C4qD4X4P.js";import{m,A as G}from"./proxy-CJ9Tpz7V.js";var _={exports:{}},de=_.exports,J;function ue(){return J||(J=1,function(C,K){(function(v,y){y()})(de,function(){function v(s,l){return typeof l>"u"?l={autoBom:!1}:typeof l!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\uFEFF",s],{type:s.type}):s}function y(s,l,u){var r=new XMLHttpRequest;r.open("GET",s),r.responseType="blob",r.onload=function(){N(r.response,l,u)},r.onerror=function(){console.error("could not download file")},r.send()}function E(s){var l=new XMLHttpRequest;l.open("HEAD",s,!1);try{l.send()}catch{}return 200<=l.status&&299>=l.status}function j(s){try{s.dispatchEvent(new MouseEvent("click"))}catch{var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),s.dispatchEvent(l)}}var d=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof D=="object"&&D.global===D?D:void 0,S=d.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),N=d.saveAs||(typeof window!="object"||window!==d?function(){}:"download"in HTMLAnchorElement.prototype&&!S?function(s,l,u){var r=d.URL||d.webkitURL,i=document.createElement("a");l=l||s.name||"download",i.download=l,i.rel="noopener",typeof s=="string"?(i.href=s,i.origin===location.origin?j(i):E(i.href)?y(s,l,u):j(i,i.target="_blank")):(i.href=r.createObjectURL(s),setTimeout(function(){r.revokeObjectURL(i.href)},4e4),setTimeout(function(){j(i)},0))}:"msSaveOrOpenBlob"in navigator?function(s,l,u){if(l=l||s.name||"download",typeof s!="string")navigator.msSaveOrOpenBlob(v(s,u),l);else if(E(s))y(s,l,u);else{var r=document.createElement("a");r.href=s,r.target="_blank",setTimeout(function(){j(r)})}}:function(s,l,u,r){if(r=r||open("","_blank"),r&&(r.document.title=r.document.body.innerText="downloading..."),typeof s=="string")return y(s,l,u);var i=s.type==="application/octet-stream",w=/constructor/i.test(d.HTMLElement)||d.safari,T=/CriOS\/[\d]+/.test(navigator.userAgent);if((T||i&&w||S)&&typeof FileReader<"u"){var f=new FileReader;f.onloadend=function(){var h=f.result;h=T?h:h.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=h:location=h,r=null},f.readAsDataURL(s)}else{var R=d.URL||d.webkitURL,b=R.createObjectURL(s);r?r.location=b:location.href=b,r=null,setTimeout(function(){R.revokeObjectURL(b)},4e4)}});d.saveAs=N.saveAs=N,C.exports=N})}(_)),_.exports}var me=ue();const k=20,fe=()=>{const[C,K]=o.useState([]),[v,y]=o.useState(0),[E,j]=o.useState(!0),[d,S]=o.useState(null),[N]=te(),s=N.get("type"),[l,u]=o.useState(""),[r,i]=o.useState(""),[w,T]=o.useState(""),[f,R]=o.useState(""),[b,h]=o.useState(1),[X,A]=o.useState(!1),[n,c]=o.useState(null);o.useEffect(()=>{const a=setTimeout(()=>{T(l)},300);return()=>clearTimeout(a)},[l]),o.useEffect(()=>{const a=setTimeout(()=>{R(r)},300);return()=>clearTimeout(a)},[r]),o.useEffect(()=>{h(1)},[w,f]);const L=o.useCallback(async(a,t,p)=>{j(!0);try{const g=await z.get("http://localhost:3000/archives/data/all",{params:{type:s,page:a,limit:k,numberCase:t,itemNumber:p}});g.data.success?(K(g.data.prosecutionData),y(g.data.total)):S("البيانات غير متوفرة")}catch{S("حدث خطأ أثناء جلب البيانات")}finally{j(!1)}},[s]);o.useEffect(()=>{L(b,w,f)},[b,w,f,L]);const W=a=>{c(a),A(!0)},Z=async a=>{if(a.preventDefault(),!!n)try{const t=await z.put(`http://localhost:3000/archives/data/update/${n.id}`,n);if(t.data.success){if(!t.data.updatedData)throw new Error("البيانات المحدثة غير موجودة");K(p=>p.map(g=>g.id===n.id?t.data.updatedData:g)),A(!1),B.success("تم التحديث بنجاح!",{icon:"✅",style:{borderRadius:"10px",background:"#4BB543",color:"#fff"}}),setTimeout(()=>{L(b,w,f)},500)}}catch(t){console.error("Update error:",t),B.error("فشل في التحديث: "+t.message,{icon:"❌",style:{borderRadius:"10px",background:"#ff4444",color:"#fff"}})}},Q=o.useMemo(()=>[{accessorKey:"serialNumber",header:"المسلسل"},{accessorKey:"itemNumber",header:"رقم الأشياء"},{accessorKey:"numberCase",header:"رقم القضية"},{accessorKey:"typeCaseNumber",header:"نوع القضية "},{accessorKey:"year",header:"السنة"},{accessorKey:"charge",header:"التهمة"},{accessorKey:"seizureStatement",header:"بيان الحرز"},{accessorKey:"totalNumber",header:"الرقم الكلي"},{accessorKey:"typeCaseTotalNumber",header:"نوع القضية "},{accessorKey:"roomNumber",header:"رقم الغرفة"},{accessorKey:"referenceNumber",header:"رقم الاستاند"},{accessorKey:"shelfNumber",header:"رقم الرف"},{accessorKey:"prosecutionDetentionDecision",header:"قرار النيابة في الحرز"},{accessorKey:"finalCourtJudgment",header:"حكم المحكمة النهائي"},{accessorKey:"statusEvidence",header:"حالة الحرز"},{id:"actions",header:"الإجراءات",cell:({row:a})=>e.jsx(m.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>W(a.original),className:"px-3 py-1 bg-blue-500 text-white rounded-lg",children:"تعديل"})}],[]),I=se({data:C,columns:Q,getCoreRowModel:ce(),getPaginationRowModel:ie(),pageCount:Math.ceil(v/k),manualPagination:!0,state:{pagination:{pageIndex:b-1,pageSize:k}}}),Y=()=>{u(""),i("")},ee=()=>{if(C.length===0){B.error("لا توجد بيانات للتصدير");return}const a=H.json_to_sheet(C),t=H.book_new();H.book_append_sheet(t,a,"بيانات الحرز");const p=ae(t,{bookType:"xlsx",type:"array"}),g=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});me.saveAs(g,"بيانات_الحرز.xlsx")};return E?e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center p-4 text-blue-600",children:"جاري تحميل البيانات..."}):d?e.jsx(m.div,{initial:{scale:.8},animate:{scale:1},className:"text-red-500 text-center p-4",children:d}):e.jsxs("div",{className:"max-w-[1500px] mx-auto p-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6 items-center justify-end",children:[e.jsxs(m.div,{initial:{x:-50},animate:{x:0},className:"flex gap-3",children:[e.jsx("input",{type:"number",placeholder:"ابحث برقم القضية...",className:"p-2 border rounded-lg w-48 text-right focus:ring-2 focus:ring-blue-500",value:l,onChange:a=>u(a.target.value),min:"0"}),e.jsx("input",{type:"number",placeholder:"ابحث برقم الأشياء...",className:"p-2 border rounded-lg w-48 text-right focus:ring-2 focus:ring-blue-500",value:r,onChange:a=>i(a.target.value),min:"0"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:Y,className:"px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"🗑️ مسح التصنيفات"}),e.jsx(m.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:ee,className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors flex items-center gap-2",children:"📥 تصدير إلى Excel"})]})]}),e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"rounded-xl border border-gray-200 shadow-lg bg-white overflow-x-auto",children:e.jsxs(le,{dir:"rtl",className:"min-w-full",children:[e.jsxs(re,{className:"bg-blue-50",children:[e.jsxs(q,{children:[e.jsx(M,{className:"text-center bg-blue-100 font-bold text-lg",colSpan:9,children:"📁 بيانات الحرز"}),e.jsx(M,{className:"text-center bg-green-100 font-bold text-lg",colSpan:3,children:"🚪 مكان تواجد الحرز"}),e.jsx(M,{className:"text-center bg-yellow-100 font-bold text-lg",colSpan:3,children:"📝 التصرف في الاحراز"}),e.jsx(M,{className:"text-center bg-red-100 font-bold text-lg",colSpan:1,children:"الإجراءات"})]}),I.getHeaderGroups().map(a=>e.jsx(q,{className:"hover:bg-blue-50",children:a.headers.map(t=>e.jsx(ne,{className:"text-center p-3 font-semibold text-gray-700",children:$(t.column.columnDef.header,t.getContext())},t.id))},a.id))]}),e.jsx(oe,{children:e.jsx(G,{children:I.getRowModel().rows.map((a,t)=>e.jsx(m.tr,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{delay:t*.05},className:"hover:bg-gray-50 even:bg-gray-50/30",children:a.getVisibleCells().map(p=>e.jsx(m.td,{className:"text-center p-3 border-t border-gray-100",children:e.jsx("div",{className:"px-2 py-1 rounded-md bg-white shadow-sm",children:$(p.column.columnDef.cell,p.getContext())})},p.id))},a.id))})})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-4 mt-6",children:[e.jsx(m.button,{onClick:()=>h(a=>Math.max(1,a-1)),disabled:b===1,className:"px-4 py-2 bg-blue-500 text-white rounded-lg disabled:bg-gray-300 flex items-center gap-2",whileHover:{scale:1.05},whileTap:{scale:.95},children:"← السابق"}),e.jsxs("span",{className:"text-gray-600 font-medium",children:["الصفحة ",b," من ",Math.ceil(v/k)]}),e.jsx(m.button,{onClick:()=>h(a=>a+1),disabled:b*k>=v,className:"px-4 py-2 bg-blue-500 text-white rounded-lg disabled:bg-gray-300 flex items-center gap-2",whileHover:{scale:1.05},whileTap:{scale:.95},children:"التالي →"})]}),e.jsx(G,{children:X&&n&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(m.div,{initial:{scale:.8},animate:{scale:1},className:"bg-white rounded-2xl shadow-xl p-8 border border-blue-100 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-center text-blue-600",children:"تعديل بيانات الحرز"}),e.jsxs("form",{onSubmit:Z,className:"space-y-8",children:[e.jsxs("fieldset",{className:"border-2 border-blue-100 rounded-xl p-6 text-right",children:[e.jsx("legend",{className:"px-2 text-xl font-semibold text-blue-600",children:"بيانات الحرز"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"المسلسل"}),e.jsx("input",{type:"number",min:"0",value:n.serialNumber,onChange:a=>c(t=>t?{...t,serialNumber:a.target.value}:null),className:"w-full px-4 py-2 border border-blue-200 rounded-xl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"رقم الأشياء"}),e.jsx("input",{type:"number",min:"0",value:n.itemNumber,onChange:a=>c(t=>t?{...t,itemNumber:a.target.value}:null),className:"w-full px-4 py-2 border border-blue-200 rounded-xl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"رقم القضية"}),e.jsx("input",{type:"number",min:"0",value:n.numberCase,onChange:a=>c(t=>t?{...t,numberCase:a.target.value}:null),className:"w-full px-4 py-2 border border-blue-200 rounded-xl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"نوع القضية لرقم القضية"}),e.jsxs(F,{value:n.typeCaseNumber||"",onValueChange:a=>c(t=>t?{...t,typeCaseNumber:a}:null),children:[e.jsx(O,{className:"w-full border-blue-200 rounded-xl",children:e.jsx(U,{placeholder:"اختر نوع القضية"})}),e.jsxs(P,{children:[e.jsx(x,{value:"جنح",children:"جنح"}),e.jsx(x,{value:"جناية",children:"جناية"}),e.jsx(x,{value:"اداري",children:"اداري"}),e.jsx(x,{value:"اقتصادية",children:"اقتصادية"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"السنة"}),e.jsx("input",{type:"text",value:n.year,onChange:a=>c(t=>t?{...t,year:a.target.value}:null),className:"w-full px-4 py-2 border border-blue-200 rounded-xl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"التهمة"}),e.jsx("input",{type:"text",value:n.charge,onChange:a=>c(t=>t?{...t,charge:a.target.value}:null),className:"w-full px-4 py-2 border border-blue-200 rounded-xl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"بيان الحرز"}),e.jsx("input",{type:"text",value:n.seizureStatement,onChange:a=>c(t=>t?{...t,seizureStatement:a.target.value}:null),className:"w-full px-4 py-2 border border-blue-200 rounded-xl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"الرقم الكلي"}),e.jsx("input",{type:"text",value:n.totalNumber,onChange:a=>c(t=>t?{...t,totalNumber:a.target.value}:null),className:"w-full px-4 py-2 border border-blue-200 rounded-xl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"نوع القضية لرقم الكلي"}),e.jsxs(F,{value:n.typeCaseTotalNumber||"",onValueChange:a=>c(t=>t?{...t,typeCaseTotalNumber:a}:null),children:[e.jsx(O,{className:"w-full border-blue-200 rounded-xl",children:e.jsx(U,{placeholder:"اختر نوع القضية"})}),e.jsxs(P,{children:[e.jsx(x,{value:"جنح",children:"جنح"}),e.jsx(x,{value:"جناية",children:"جناية"}),e.jsx(x,{value:"اداري",children:"اداري"}),e.jsx(x,{value:"اقتصادية",children:"اقتصادية"})]})]})]})]})]}),e.jsxs("fieldset",{className:"border-2 border-blue-100 rounded-xl p-6 text-right",children:[e.jsx("legend",{className:"px-2 text-xl font-semibold text-blue-600",children:"مكان تواجد الحرز"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"رقم الغرفة"}),e.jsx("input",{type:"number",min:"0",value:n.roomNumber,onChange:a=>c(t=>t?{...t,roomNumber:a.target.value}:null),className:"w-full px-4 py-2 border border-blue-200 rounded-xl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"رقم الاستاند"}),e.jsx("input",{type:"number",min:"0",value:n.referenceNumber,onChange:a=>c(t=>t?{...t,referenceNumber:a.target.value}:null),className:"w-full px-4 py-2 border border-blue-200 rounded-xl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"رقم الرف"}),e.jsx("input",{type:"number",min:"0",value:n.shelfNumber,onChange:a=>c(t=>t?{...t,shelfNumber:a.target.value}:null),className:"w-full px-4 py-2 border border-blue-200 rounded-xl"})]})]})]}),e.jsxs("fieldset",{className:"border-2 border-blue-100 rounded-xl p-6 text-right",children:[e.jsx("legend",{className:"px-2 text-xl font-semibold text-blue-600",children:"التصرف في الحرز"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"قرار النيابة"}),e.jsx("input",{type:"text",value:n.prosecutionDetentionDecision,onChange:a=>c(t=>t?{...t,prosecutionDetentionDecision:a.target.value}:null),className:"w-full px-4 py-2 border border-blue-200 rounded-xl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"حكم المحكمة النهائي"}),e.jsx("input",{type:"text",value:n.finalCourtJudgment,onChange:a=>c(t=>t?{...t,finalCourtJudgment:a.target.value}:null),className:"w-full px-4 py-2 border border-blue-200 rounded-xl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"حالة الحرز"}),e.jsxs(F,{value:n.statusEvidence,onValueChange:a=>c(t=>t?{...t,statusEvidence:a}:null),children:[e.jsx(O,{className:"w-full border-blue-200 rounded-xl",children:e.jsx(U,{placeholder:"اختر حالة الحرز"})}),e.jsxs(P,{children:[e.jsx(x,{value:" على ذمة التحقيق",children:" على ذمة التحقيق "}),e.jsx(x,{value:"جاهز للتسليم",children:"جاهز للتسليم"}),e.jsx(x,{value:"جاهز للبيع",children:"جاهز للبيع"}),e.jsx(x,{value:"جاهز للاعدام",children:"جاهز للإعدام"})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(V,{type:"button",onClick:()=>A(!1),variant:"outline",className:"px-6 py-2",children:"إلغاء"}),e.jsx(V,{type:"submit",className:"bg-indigo-600 hover:bg-indigo-700 px-6 py-2",children:"حفظ التغييرات"})]})]})]})})})]})};export{fe as default};
