import{r as c,u as re,j as e,I as L,B as I,b as A,_ as M,d as z}from"./index-mz9mZwsC.js";import{u as ce,T as ie,a as le,b as W,c as ne,f as J,d as oe,e as de,g as he,h as ue,i as xe}from"./index-Du1KXNz1.js";import{D as G,a as X,b as Y,c as Z,d as q,e as me,E as je}from"./exceljs.min-B4EiSvJd.js";import{S as h,a as u,b as x,c as m,d as a}from"./select-BbpFdzmn.js";const be=({children:b,caseID:g,caseNumber:V,accusation:N,defendantQuestion:T,officerQuestion:f,victimQuestion:C,witnessQuestion:p,technicalReports:k,caseReferral:P,isReadyForDecision:F,actionOther:B})=>{const[y,_]=c.useState(V),{userData:Q}=re(),[n,E]=c.useState(N),[R,S]=c.useState(T),[s,t]=c.useState(f),[o,r]=c.useState(C),[i,w]=c.useState(p),[v,H]=c.useState(k),[U,ee]=c.useState(P),[se,ge]=c.useState(F),[O,te]=c.useState(B),D=Q==null?void 0:Q.member_id,ae=async K=>{K.preventDefault();const l={id:g.toString()};if(y&&(l.caseNumber=y),D&&(l.memberNumber=D.toString()),n&&(l.accusation=n),R&&(l.defendantQuestion=R),s&&(l.officerQuestion=s),o&&(l.victimQuestion=o),i&&(l.witnessQuestion=i),v&&(l.technicalReports=v),U&&(l.caseReferral=U),O&&(l.actionOther=O),l.isReadyForDecision=se,Object.keys(l).length>1)try{const d=await A.put("http://localhost:3000/api/private/cases/edit",l);M.success("تم التحديث بنجاح!")}catch(d){M.error("فشلت عملية التحديث"),console.error(d)}else M.error("يرجى ملء حقل واحد على الأقل للتحديث")},$=K=>{const{name:l,value:d}=K.target;switch(l){case"caseNumber":_(d);break;case"accusation":E(d);break;case"defendantQuestion":S(d);break;case"officerQuestion":t(d);break;case"victimQuestion":r(d);break;case"witnessQuestion":w(d);break;case"technicalReports":H(d);break;case"caseReferral":ee(d);break}};return e.jsxs(G,{children:[e.jsx(X,{asChild:!0,children:b}),e.jsxs(Y,{dir:"rtl",className:"bg-[#1B2431]  text-white border-none",children:[e.jsx(Z,{children:e.jsx(q,{children:"تعديل القضية"})}),e.jsxs("form",{onSubmit:ae,className:"space-y-4 flex flex-col justify-center",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"caseNumber",children:"رقم القضية"}),e.jsx(L,{name:"caseNumber",value:y,onChange:$,type:"text",min:"1",placeholder:"رقم القضية",className:"bg-[#283444] text-white w-full"})]}),e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"memberNumber",children:"رقم العضو"}),e.jsxs(h,{dir:"rtl",disabled:!0,value:D?D.toString():"",children:[e.jsx(u,{className:"w-[175px] bg-[#283444]  text-white  border-white  ",children:e.jsx(x,{placeholder:"رقم العضو"})}),e.jsxs(m,{className:"bg-[#1B2431]  text-white border-none",children:[e.jsx(a,{value:"1",children:"1"}),e.jsx(a,{value:"2",children:"2"}),e.jsx(a,{value:"3",children:"3"}),e.jsx(a,{value:"4",children:"4"}),e.jsx(a,{value:"5",children:"5"}),e.jsx(a,{value:"6",children:"6"}),e.jsx(a,{value:"7",children:"7"}),e.jsx(a,{value:"8",children:"8"}),e.jsx(a,{value:"9",children:"9"}),e.jsx(a,{value:"10",children:"10"})]})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"accusation",children:"التهمة"}),e.jsx(L,{name:"accusation",onChange:$,value:n,type:"text",placeholder:"التهمة",className:"bg-[#273142] text-white w-full"})]}),e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"defendantQuestion",children:"سؤال المتهم"}),e.jsxs(h,{dir:"rtl",value:R,name:"defendantQuestion",onValueChange:S,children:[e.jsx(u,{className:"w-[175px] bg-[#283444] text-white  border-white  ",children:e.jsx(x,{placeholder:"سؤال المتهم"})}),e.jsxs(m,{className:"bg-[#1B2431]  text-white border-none",children:[e.jsx(a,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(a,{value:"تم",children:"تم"}),e.jsx(a,{value:"حتى الآن",children:"حتى الآن"})]})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"officerQuestion",children:"سؤال الضابط"}),e.jsxs(h,{dir:"rtl",value:s,name:"officerQuestion",onValueChange:t,children:[e.jsx(u,{className:"w-[175px] bg-[#283444] text-white  border-white  ",children:e.jsx(x,{placeholder:"سؤال المتهم"})}),e.jsxs(m,{className:"bg-[#1B2431]  text-white border-none",children:[e.jsx(a,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(a,{value:"تم",children:"تم"}),e.jsx(a,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"victimQuestion",children:"سؤال المجني عليه"}),e.jsxs(h,{dir:"rtl",value:o,name:"victimQuestion",onValueChange:r,children:[e.jsx(u,{className:"w-[175px] bg-[#283444] text-white  border-white  ",children:e.jsx(x,{placeholder:"سؤال المتهم"})}),e.jsxs(m,{className:"bg-[#1B2431]  text-white border-none",children:[e.jsx(a,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(a,{value:"تم",children:"تم"}),e.jsx(a,{value:"حتى الآن",children:"حتى الآن"})]})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"witnessQuestion",children:"سؤال الشهود"}),e.jsxs(h,{dir:"rtl",value:i,name:"witnessQuestion",onValueChange:w,children:[e.jsx(u,{className:"w-[175px] bg-[#283444] text-white  border-white  ",children:e.jsx(x,{placeholder:"سؤال المتهم"})}),e.jsxs(m,{className:"bg-[#1B2431]  text-white border-none",children:[e.jsx(a,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(a,{value:"تم",children:"تم"}),e.jsx(a,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"technicalReports",children:"التقارير الفنية"}),e.jsxs(h,{dir:"rtl",value:v,onValueChange:H,children:[e.jsx(u,{className:"w-[175px] bg-[#283444] text-white  border-white  ",children:e.jsx(x,{placeholder:"اختيار الحالة"})}),e.jsxs(m,{className:"bg-[#1B2431]  text-white border-none",children:[e.jsx(a,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(a,{value:"تم",children:"تم"}),e.jsx(a,{value:"حتى الآن",children:"حتى الآن"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-5 space-x-4",children:[e.jsx("label",{htmlFor:"technicalReports",children:"اجراءات اخرى"}),e.jsxs(h,{dir:"rtl",value:O,onValueChange:te,children:[e.jsx(u,{className:"w-[175px] bg-[#283444] text-white  border-white  ",children:e.jsx(x,{placeholder:"اختيار الحالة"})}),e.jsxs(m,{className:"bg-[#1B2431]  text-white border-none",children:[e.jsx(a,{value:"لا يوجد",children:"لا يوجد"}),e.jsx(a,{value:"تم",children:"تم"}),e.jsx(a,{value:"حتى الآن",children:"حتى الآن"})]})]})]}),e.jsx(I,{type:"submit",variant:"default",className:"bg-[#4741DE] hover:bg-[#6A68FF] self-center min-w-56",children:"حفظ التعديلات"})]}),e.jsx(me,{className:"mt-4"})]})]})},j=({children:b,contact:g})=>e.jsxs(G,{children:[e.jsx(X,{asChild:!0,dir:"rtl",children:b}),e.jsxs(Y,{className:"text-center",children:[e.jsx(Z,{children:e.jsx(q,{children:"المحتوى"})}),e.jsx("div",{children:g})]})]}),Ne=()=>{const[b,g]=c.useState([]),[V,N]=c.useState([]),[T]=c.useState(10),[f,C]=c.useState(""),[p,k]=c.useState(""),[P,F]=c.useState(!1),B=async()=>{try{const o=((await A.get("http://localhost:3000/api/private/cases")).data.cases||[]).map(r=>({...r,isReadyForDecision:!!(r.defendantQuestion&&r.officerQuestion&&r.victimQuestion&&r.witnessQuestion&&r.technicalReports&&r.caseReferral)}));g(o),N(o)}catch(s){console.error("Error fetching data:",s)}},y=()=>{C(""),k("")},_=async s=>{try{const r=((await A.get(`http://localhost:3000/api/private/cases/${s}`)).data.cases||[]).map(i=>({...i,isReadyForDecision:!!(i.defendantQuestion&&i.officerQuestion&&i.victimQuestion&&i.witnessQuestion&&i.technicalReports&&i.caseReferral)}));g(r),N(r)}catch(t){console.error("Error fetching data:",t)}};c.useEffect(()=>{const s=z.get("uuid"),t=z.get("role");t==="admin"||t==="editor"?(F(!0),t==="admin"?B():t==="editor"&&s&&_(s)):F(!1)},[]),c.useEffect(()=>{(()=>{const t=b.filter(o=>{const r=f?o.memberNumber===f:!0,i=p?o.isReadyForDecision===(p==="نعم"):!0;return r&&i});N(t)})()},[f,p,b]);const Q=c.useMemo(()=>[{accessorKey:"caseNumber",header:"رقم القضية",cell:s=>{const t=s.getValue();return e.jsx(j,{contact:t,children:e.jsx("p",{children:t})})}},{accessorKey:"memberNumber",header:"رقم العضو",cell:s=>{const t=s.getValue();return e.jsx(j,{contact:t,children:e.jsx("p",{children:t})})}},{accessorKey:"accusation",header:"التهمة",cell:s=>{const t=s.getValue();return e.jsx(j,{contact:t,children:e.jsx("p",{children:t})})}},{accessorKey:"defendantQuestion",header:"سؤال المتهم",cell:s=>{const t=s.getValue();return e.jsx(j,{contact:t,children:e.jsx("p",{children:t})})}},{accessorKey:"officerQuestion",header:"سؤال الضابط",cell:s=>{const t=s.getValue();return e.jsx(j,{contact:t,children:e.jsx("p",{children:t})})}},{accessorKey:"victimQuestion",header:"سؤال المجني عليه",cell:s=>{const t=s.getValue();return e.jsx(j,{contact:t,children:e.jsx("p",{children:t})})}},{accessorKey:"witnessQuestion",header:"سؤال الشهود",cell:s=>{const t=s.getValue();return e.jsx(j,{contact:t,children:e.jsx("p",{children:t})})}},{accessorKey:"technicalReports",header:"التقارير الفنية",cell:s=>{const t=s.getValue();return e.jsx(j,{contact:t,children:e.jsx("p",{children:t})})}},{accessorKey:"actionOther",header:"اجراءات اخرى"},{accessorKey:"isReadyForDecision",header:"جاهزة للتصرف",cell:s=>{const t=s.row.original.defendantQuestion||s.row.original.officerQuestion||s.row.original.victimQuestion||s.row.original.witnessQuestion;return[s.row.original.defendantQuestion,s.row.original.officerQuestion,s.row.original.victimQuestion,s.row.original.witnessQuestion,s.row.original.technicalReports].some(r=>r&&r.includes("حتى الآن"))?"لا":t?"نعم":"لا"}},{header:"تعديل",cell:s=>e.jsx("div",{className:"flex justify-center items-center ",children:e.jsx(be,{actionOther:s.row.original.actionOther,caseID:Number(s.row.original.id),caseNumber:s.row.original.caseNumber,memberNumber:s.row.original.memberNumber,accusation:s.row.original.accusation,defendantQuestion:s.row.original.defendantQuestion,officerQuestion:s.row.original.officerQuestion,victimQuestion:s.row.original.victimQuestion,witnessQuestion:s.row.original.witnessQuestion,technicalReports:s.row.original.technicalReports,caseReferral:s.row.original.caseReferral,isReadyForDecision:s.row.original.isReadyForDecision,children:e.jsx("img",{src:"/edit.svg",width:24,height:24,alt:""})})})}],[]),n=ce({data:V,columns:Q,state:{pagination:{pageIndex:0,pageSize:T}},getCoreRowModel:xe(),getPaginationRowModel:ue()}),E=()=>n.nextPage(),R=()=>n.previousPage(),S=async()=>{const s=new je.Workbook,t=s.addWorksheet("Cases");t.columns=[{header:"رقم القضية",key:"caseNumber",width:20},{header:"رقم العضو",key:"memberNumber",width:20},{header:"التهمة",key:"accusation",width:30},{header:"سؤال المتهم",key:"defendantQuestion",width:30},{header:"سؤال الضابط",key:"officerQuestion",width:30},{header:"سؤال المجني عليه",key:"victimQuestion",width:30},{header:"سؤال الشهود",key:"witnessQuestion",width:30},{header:"التقارير الفنية",key:"technicalReports",width:30},{header:"إجراءات أخرى",key:"actionOther",width:20},{header:"جاهزة للتصرف",key:"isReadyForDecision",width:20}],b.forEach(v=>{t.addRow({...v,isReadyForDecision:v.isReadyForDecision?"نعم":"لا"})});const o=await s.xlsx.writeBuffer(),r=new Blob([o],{type:"application/octet-stream"}),i=window.URL.createObjectURL(r),w=document.createElement("a");w.href=i,w.download="cases.xlsx",w.click(),window.URL.revokeObjectURL(i)};return P?e.jsxs("div",{className:"flex flex-col items-center h-[110vh] space-y-4",children:[e.jsxs("div",{dir:"rtl",className:"w-[1210px] ",children:[e.jsxs("div",{className:"flex items-center self-end space-x-4 mb-4 gap-5",children:[e.jsxs(h,{dir:"rtl",value:f,onValueChange:s=>C(s),children:[e.jsx(u,{className:"w-[156px]",children:e.jsx(x,{placeholder:"رقم العضو"})}),e.jsxs(m,{children:[e.jsx(a,{value:"1",children:"1"}),e.jsx(a,{value:"2",children:"2"}),e.jsx(a,{value:"3",children:"3"}),e.jsx(a,{value:"4",children:"4"}),e.jsx(a,{value:"5",children:"5"}),e.jsx(a,{value:"6",children:"6"}),e.jsx(a,{value:"7",children:"7"}),e.jsx(a,{value:"8",children:"8"}),e.jsx(a,{value:"9",children:"9"}),e.jsx(a,{value:"10",children:"10"})]})]}),e.jsxs(h,{dir:"rtl",value:p,onValueChange:s=>k(s),children:[e.jsx(u,{className:"w-[156px]",children:e.jsx(x,{placeholder:" جاهزة للتصرف"})}),e.jsxs(m,{children:[e.jsx(a,{value:"نعم",children:"نعم"}),e.jsx(a,{value:"لا",children:"لا"})]})]}),e.jsx(I,{className:"bg-purple-700 hover:bg-purple-500",onClick:y,children:"مسح الفلاتر"}),e.jsx(I,{onClick:S,className:"bg-green-500 hover:bg-green-400",children:"تصدير إلى أكسل"})]}),e.jsxs(ie,{className:" overflow-hidden",children:[e.jsx(le,{children:n.getHeaderGroups().map(s=>e.jsx(W,{className:"text-center",children:s.headers.map(t=>e.jsx(ne,{className:"text-center",children:J(t.column.columnDef.header,t.getContext())},t.id))},s.id))}),e.jsx(oe,{children:n.getRowModel().rows.map(s=>e.jsx(W,{children:s.getVisibleCells().map(t=>e.jsx(de,{className:"text-center align-middle truncate max-w-[150px]",children:J(t.column.columnDef.cell,t.getContext())},t.id))},s.id))}),e.jsx(he,{})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:R,disabled:!n.getCanPreviousPage(),className:"border rounded p-2",children:"السابق"}),n.getPageOptions().map(s=>e.jsx("button",{onClick:()=>n.setPageIndex(s),className:`border rounded p-2 ${n.getState().pagination.pageIndex===s?"bg-purple-500 text-white":""}`,children:s+1},s)),e.jsx("button",{onClick:E,disabled:!n.getCanNextPage(),className:"border rounded p-2",children:"التالي"})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center h-screen",children:e.jsx("p",{className:"text-2xl text-red-500",children:"غير مصرح لك بالاطلاع على البيانات."})})};export{Ne as default};
