import{r as t,u as me,j as e,B as m,I as i,d as I,_ as x}from"./index-DuPbkBlM.js";import{X as xe,P as ue}from"./progress-B5vEx7DL.js";import{r as ge,u as he}from"./xlsx-fdabpkSu.js";import{S as f,a as N,b as y,c as v,d as n}from"./select-C4qD4X4P.js";import{A as be,m as te}from"./proxy-CJ9Tpz7V.js";const ve=()=>{const[P,_]=t.useState(""),[u,$]=t.useState(""),[g,T]=t.useState(""),[re,F]=t.useState(""),[R,V]=t.useState(""),[z,B]=t.useState(""),[M,O]=t.useState(""),[U,L]=t.useState(""),[G,le]=t.useState(""),[X,Y]=t.useState(""),{userData:S}=me(),q=S==null?void 0:S.member_id,[ne,b]=t.useState(!1),[ce,H]=t.useState(0),[J,K]=t.useState(0),[Q,W]=t.useState(0),[Z,p]=t.useState(!1),[w,ee]=t.useState(null),[se,D]=t.useState(!1),ae={1:"الأولى",2:"الثانية",3:"الثالثة",4:"الرابعة",5:"الخامسة",6:"السادسة",7:"السابعة",8:"الثامنة",9:"التاسعة",10:"العاشرة",11:"الحادية عشرة",12:"الثانية عشرة",13:"الثالثة عشرة",14:"الرابعة عشرة",15:"الخامسة عشرة",16:"السادسة عشرة",17:"السابعة عشرة",18:"الثامنة عشرة",19:"التاسعة عشرة",20:"العشرون"};t.useEffect(()=>{if(u&&g){const s=new Date(u);s.setDate(s.getDate()+parseInt(g,10)-1);const r=s.toLocaleDateString("ar-EG",{year:"numeric",month:"numeric",day:"numeric"});F(r)}},[u,g]);const ie=async s=>{var r;s.preventDefault();try{await I.post("http://localhost:3000/api/public/cases/add",{caseNumber:P,defendantName:X,startDate:u,imprisonmentDuration:g,issuingDepartment:R,type_case:z,member_number:q,officeNumber:M,year:U,investigationID:G}),x.success("تم إضافة القضية بنجاح"),_(""),Y(""),$(""),T(""),F(""),V(""),B(""),O(""),L("")}catch(c){c instanceof Error?I.isAxiosError(c)?x.error(((r=c.response)==null?void 0:r.data.message)||c.message):x.error("An unknown error occurred"):console.error("An unknown error occurred")}},oe=s=>{const r={"٠":"0","١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9"},o=s.split("").map(l=>r[l]||l).join("").replace(/[^0-9/]/g,"").replace(/\s/g,"").split("/");if(o.length!==3||o.some(l=>isNaN(parseInt(l))))throw new Error("صيغة التاريخ غير صالحة");const[d,j,C]=o,k=`${C}-${j.padStart(2,"0")}-${d.padStart(2,"0")}`;if(isNaN(new Date(k).getTime()))throw new Error("تاريخ غير صالح");return k},de=async s=>{const r=new FileReader;r.onload=async c=>{var o;try{const d=new Uint8Array((o=c.target)==null?void 0:o.result),j=ge(d,{type:"array"}),C=j.Sheets[j.SheetNames[0]],l=he.sheet_to_json(C).map(a=>({caseNumber:a["رقم القضية"],year:a.السنة,type_case:a["نوع القضية"],investigationID:a["رقم حصر التحقيق"],defendantName:a["اسم المتهم"],member_number:a["رقم العضو"],startDate:oe(a["بداية المدة"]),imprisonmentDuration:a["مدة الحبس"],issuingDepartment:a["دائرة مصدر القرار"],officeNumber:a["رقم الدائرة"]}));p(!0);let A=0,E=0;for(let a=0;a<l.length;a++){try{if(!l[a].startDate||isNaN(new Date(l[a].startDate).getTime()))throw new Error("تاريخ غير صالح في الصف "+(a+1));await I.post("http://localhost:3000/api/public/cases/add",l[a]),A++}catch(h){E++,h instanceof Error?console.error(`خطأ في الصف ${a+1}:`,h.message):console.error(`خطأ في الصف ${a+1}:`,h)}H((a+1)/l.length*100),K(A),W(E),await new Promise(h=>setTimeout(h,500))}p(!1),D(!0),ee(null),x.success(`تم استيراد ${A} قضية بنجاح مع ${E} أخطاء`)}catch(d){d instanceof Error?x.error("حدث خطأ في معالجة الملف: "+d.message):x.error("حدث خطأ في معالجة الملف"),p(!1)}},r.readAsArrayBuffer(s)};return e.jsx("div",{dir:"rtl",className:"min-h-screen bg-gradient-to-b from-blue-50 to-indigo-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"  h-[70px] text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"إضافة قضية جديدة"}),e.jsx(m,{onClick:()=>b(!0),className:"bg-green-600 hover:bg-green-700",children:"استيراد من Excel"})]}),e.jsx(be,{children:(ne||se)&&e.jsx(te.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(te.div,{initial:{scale:.8},animate:{scale:1},className:"bg-white rounded-2xl shadow-xl p-8 border border-blue-100 w-full max-w-2xl relative",children:[e.jsx("button",{onClick:()=>{b(!1),D(!1),H(0),K(0),W(0)},className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",children:e.jsx(xe,{className:"h-6 w-6"})}),!Z&&!se?e.jsxs("div",{className:"space-y-6",children:[e.jsx(i,{type:"file",accept:".xlsx, .xls",onChange:s=>{var r;return ee(((r=s.target.files)==null?void 0:r[0])||null)}}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(m,{variant:"outline",onClick:()=>b(!1),children:"إلغاء"}),e.jsx(m,{disabled:!w,onClick:()=>w&&de(w),children:"بدء الاستيراد"})]})]}):e.jsx("div",{className:"space-y-6 text-center",children:Z?e.jsxs(e.Fragment,{children:[e.jsx(ue,{value:ce,className:"h-3"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-green-600",children:["الناجحة: ",J]}),e.jsxs("div",{className:"text-red-600",children:["خطأ: ",Q]})]}),e.jsx(m,{variant:"destructive",onClick:()=>p(!1),children:"إيقاف الاستيراد"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"نتيجة الاستيراد"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"bg-green-100 p-4 rounded-lg",children:[e.jsx("span",{className:"text-green-700 font-bold",children:J}),e.jsx("p",{className:"text-sm",children:"استيراد ناجح"})]}),e.jsxs("div",{className:"bg-red-100 p-4 rounded-lg",children:[e.jsx("span",{className:"text-red-700 font-bold",children:Q}),e.jsx("p",{className:"text-sm",children:"خطأ"})]})]}),e.jsx(m,{onClick:()=>{D(!1),b(!1)},className:"mt-4",children:"إغلاق"})]})})]})})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-blue-100",children:e.jsxs("form",{onSubmit:ie,className:"space-y-8",children:[e.jsxs("fieldset",{className:"border-2 border-blue-100 rounded-xl p-6 text-right",children:[e.jsx("legend",{className:"px-2 text-xl font-semibold text-blue-600",children:"بيانات القضية"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"رقم القضية"}),e.jsx(i,{type:"text",value:P,onChange:s=>_(s.target.value),className:"border-blue-200 focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"السنة"}),e.jsx(i,{type:"number",value:U,onChange:s=>L(s.target.value),className:"border-blue-200 focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"نوع القضية"}),e.jsxs(f,{value:z,onValueChange:B,children:[e.jsx(N,{className:"border-blue-200 focus:ring-2 focus:ring-indigo-500",children:e.jsx(y,{placeholder:"اختر النوع"})}),e.jsxs(v,{children:[e.jsx(n,{value:"جنحة",children:"جنحة"}),e.jsx(n,{value:"جناية",children:"جناية"}),e.jsx(n,{value:"اداري",children:"اداري"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"رقم حصر التحقيق"}),e.jsx(i,{type:"text",value:G,onChange:s=>le(s.target.value),className:"border-blue-200 focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"اسم المتهم"}),e.jsx(i,{type:"text",value:X,onChange:s=>Y(s.target.value),className:"border-blue-200 focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"رقم العضو"}),e.jsxs(f,{disabled:!0,value:(q??"").toString(),children:[e.jsx(N,{className:"border-blue-200 focus:ring-2 focus:ring-indigo-500",children:e.jsx(y,{placeholder:"رقم العضو"})}),e.jsx(v,{children:Array.from({length:10},(s,r)=>r+1).map(s=>e.jsx(n,{value:s.toString(),children:s},s))})]})]})]})]}),e.jsxs("fieldset",{className:"border-2 border-blue-100 rounded-xl p-6 text-right",children:[e.jsx("legend",{className:"px-2 text-xl font-semibold text-blue-600",children:"معلومات التجديد"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"بداية المدة"}),e.jsx(i,{type:"date",value:u,onChange:s=>$(s.target.value),className:"border-blue-200 focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"مدة الحبس"}),e.jsx(i,{type:"number",value:g,onChange:s=>T(s.target.value),className:"border-blue-200 focus:ring-2 focus:ring-indigo-500",min:"1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"موعد التجديد"}),e.jsx("div",{className:"w-full px-4 py-2 border border-blue-200 rounded-lg bg-gray-50",children:re||"--/--/----"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"الدائرة مصدرة القرار"}),e.jsxs(f,{value:R,onValueChange:V,children:[e.jsx(N,{className:"border-blue-200 focus:ring-2 focus:ring-indigo-500",children:e.jsx(y,{placeholder:"اختر الدائرة"})}),e.jsxs(v,{children:[e.jsx(n,{value:"جزئي",children:"جزئي"}),e.jsx(n,{value:"مستأنف",children:"مستأنف"}),e.jsx(n,{value:"جنايات",children:"جناية"}),e.jsx(n,{value:"رئيس نيابة",children:"رئيس نيابة"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"رقم الدائرة"}),e.jsxs(f,{value:M,onValueChange:O,children:[e.jsx(N,{className:"border-blue-200 focus:ring-2 focus:ring-indigo-500",children:e.jsx(y,{placeholder:"اختر الرقم"})}),e.jsx(v,{children:Array.from({length:20},(s,r)=>r+1).map(s=>e.jsx(n,{value:ae[s],children:ae[s]},s))})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(m,{type:"submit",className:"mt-6 bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-xl text-lg",children:"إضافة القضية"})})]})})]})})};export{ve as default};
